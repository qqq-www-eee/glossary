## Наряды и реестры на выплату. Частичное закрытие работ

### Используемые понятия

1. **Наряд** - таблица, отражающая объёмы выполненных работ за определенный период по всем работникам секции. Закрывается технадзором: после приемки работ, приемки отработанных замечаний, если они были, и фиксации всех фактических показателей работ. Выглядит приблизительно [так]() или [так]().
2. **Реестр на выплату** (**реестр**) - документ, формируемый после закрытия наряда руководителем координации. Это финансовая выжимка наряда с указанием сумм к выплате, направляемая в бухгалтерию. Выглядит [так]().
3. **Расчетный период** - период времени, за который составляется наряд и соответствующий реестр на выплату. Как правило, по бизнесу пользователю расчетный период заранее известен и не изменяется (обычно 7 дней). Система между периодами никак не итерируется - даты расчетного периода имеют символическое значение и подбираются автоматически при формировании наряда.
4. **Работа** (**родительская работа**) - проведение определенного наименования работ в определенном помещении. Может длиться один или нескольких расчетных периодов. Работа может быть разбита на "частичные работы". Не путать с наименованием работ, которые приведены в справочнике. Работа однозначно определяется по комбинации work_id + storey + room_group и по сути есть слайс помещения под конкретную работу. 
5. **Частичная работа** - часть работы, длящаяся 1 расчетный период. У частичной работы за время ее жизни по бизнесу исполнитель подразумевается неизменным. Поля "Выдано работ" и "Выполнено" принадлежат именно частичной работе.
6. **Частичное закрытие наряда** (**процентовка**) - процесс сбора и подготовки информации по объекту для взаиморасчета с мастерами за 1 расчетный период (т. е. за 1 частичную работу).  
7. **Перерасход** - состояние работы, при котором сумма значений "объем выполненных работ" по всем ее частичным работам превышает значение ее поля "Дефектовка".
8. ~~**Частичный перерасход** - состояние частичной работы, при котором текущий объем выполненных работ превышает значение поля "Выдано". Это скорее не перерасход, а это ошибка - зачесть работы и не учесть, куда взяты материалы. Пока нет смысла на этом фокусироваться.~~

### Некоторые тезисы

1. Для описания частичного закрытия нарядов оказалось недостаточно понятия таски. Наши таски необходимо разделить на две сущности с более понятными атрибутами и статусной моделью. Что привело к такой мысли:
    1. Не совсем понятно, чем отличаются статусы "Ожидает дефектовку" и "Готово к работе".
    2. Один и тот же статус "Ожидает дефектовку" для созданной и несозданной таски технически отличается: в начале, когда таска не создана, "Ожидает дефектовку" = "Таски нет и статуса нет", а когда таска создана (например была указана дефектовка = 0), "Ожидает дефектовку" становится реальным статусом.
    3. Три серых цвета ни при чем, но хочется отметить.
    4. Дефектовка - это история, которую делают один-единственный раз в самом начале объекта, когда принимают его. Из-за передачи фронта работ и других соображений дефектовка ближе к атрибутам "работы", чем к атрибутам "помещения", но она точно не относится к сущности, оседающей в закрываемых нарядах. 
    5. Новые замечания технадзоры оставляют каждый расчетный период.
    6. Статусы об оплате, какими бы они ни были, также должны работать с периодичность в неделю, но главное - тем сущностям, которые попадают в частичные наряды и в рамках них же закрываются, нужен некий флаг ("статус", либо bool, либо дата оплаты), отличающий уже оплаченную порцию работы от неоплаченной.
    7. Ячейка "Вид работ" нужна зеленой тогда, когда действительно закончен целый срез работ. То есть зеленая фасолина должна обозначать одну реально завершенную работу. Даже если мы хотим, чтобы ячейка "Вид работ" окрашивалась каждую неделю в знак завершенных частичных работ, нам лучше различать эти два состояния - например, красить фасолину отдельно в сине-зеленый и отдельно в ярко-зеленый. Это позволит пользователю отличать во вкладке обзор работы, которые "Готовы в рамках периода" от тех, что "Совсем готовы". Но надо также помнить, что работы будут выполняться последовательно, и сине-зеленый никогда не случится.
    8. Как понять, что частичная работа готова к оплате? Самое просто решение - за счет нового промежуточного статуса.  
    9. **Итог: "статусы рабочего процесса" прикрепить к работе, не к частичной работе (у нас это так). "статус оплаты" при этом невозможно отделить от частичной работы (ей нужно делегировать поле paid_at). Плюс работам добавить как минимум 1 новый статус вроде readyToPay**. В общем, ключевой момент - разнести "статус рабочего процесса" и "статус оплаты", потому что они попросту независимы. Вторая сущности нужна для нарядов внутри, первая - для вкладки "Обзор".
2. За частичную работу платят в рамках одного отдельно взятого расчетного периода (и наряда). После закрытия этого наряда для вошедших в него частичных работ, **если их основная работа еще себя не исчерпала, пересоздаются новые сущности частичных работ "на остаток"** - чтобы уже оплаченные работы больше ни в один наряд не попали, но и работа при этом не затерялась. Но что значит "основная работа себя не исчерпала"?
    1. Критерием, когда **перестаем** создавать таски на остаток (иначе в конце каждой работы будут генериться вечно висящие таски, попадающие в наряды) могут быть:
        1. **opt1**: Хотя значение дефектовки редактируемо, при пересоздании частичных работ мы могли бы полагаться на это поле (тогда Пользователю нужно подстветить и объяснить эту логику - мол, свободный ввод данных в поле дефектовка не значит, что мы на нее не смотрим - мы смотрим). Но пользователь может захотеть работать в шахматке с ситуацией "контролируемого перерасхода" - и придется костылить: вводить в дефектовке ненастоящие значения, потом все равно потребуется кнопка для создания таски, либо придется откатывать шахматку до предыдущей версии и править дефектовку там и пр. Очень тяжелый вариант, перегруженная логика.
        2. **opt2**: Всегда пересоздавать таску на остаток, но дать пользователю кнопку, убивающую таску.
        3. **opt3**: Ввести новый статус: пользователь переводит работы в статус "Готово1" (readyToPay), при котором таска будет пересоздаваться на остаток, или в другой статус "Готово2" (completed), при котором таска на остаток пересоздаваться уже не будет. Первая на вкладке "Обзор" покрасит фасолину, скажем, в сине-зеленый; вторая - в ярко-зеленый.
            1. Это позволит потом даже расширить функционал вкладки "Обзор" - позволит пользователю отличать работы, которые "Готовы в моменте" от тех, что "Готово совсем".
            2. Если объем выполненных работ совпадает с дефектовкой или превышает ее, возможно, пользователю необходимо подсказать, что, вероятно, ему нужен статус 'completed', тогда как он пытается проставить 'readyToPay'. Возможно, это надо делать в боковой панели, а возможно - в нарядах.
        4. **opt4**: Можно при формировании наряда прямо спрашивать - вы эту работу хотите дальше отслеживать? Надо будет все время проставлять либо тогглы, либо чекбоксы. Немного не дружественно, но от проставления статусов всем записям о работе недалеко ушло. В принципе рабочий вариант.
    2. А каковы базовые (полные) условия попадания частичной работы в наряд?
        1. Правильный статус:
            1. Если мы решаем баловаться со статусами, то это 
                1. Те, что "readyToPay." У них создастся новая частичная работа на остаток;
                2. Те, что "completed". Просто завершаются.
            2. Если хотим оставить старые статусы, то это
                1. Статус "Завершено" ("completed")
        2. У них указан исполнитель;
        3. Указан объем произведенных работ.
        4. Невыполнение критерия останова (пункт выше). Если играемся со статусами, то наличие/отсутствие критерия автоматчиески прилагается к статусу.
    3. Не смущает ли нас, что фасолины и также ячейка "Видов работ" красятся в зеленый по одному принципу (статус), а работы на оплату уходят другие? (их подмножество с указанными объемами и указанными исполнителями)?   
3. Еще один раз о том же. С перспективы того, что есть на данный момент: кашу из статусов надо разделить по 3-м сущностям: "помещение", "родительская работа" и "частичная работа".
    1. Полный (даже расширенный) список статусов:
        1. Ожидает дефектовку
        2. ~~Отдефектовано (может совпадать с "Готово к работе")~~
        2. Готово к работе.
        3. В работе.
        4. Ожидает технадзор.
        5. Есть замечания.
        6. Завершено.
        7. ~~Готово к оплате (может совпадать с "Завершено")~~
        8. ~~Оплачено~~
    2. Распределение:
        1. Частичной работе достается bool: "Оплачено" - "Не оплачено".
        2. Работе достаются: "В работе", "Ожидает технадзор", "Есть замечания", "Завершено". Менее очевидно, но также достаются работе "Готово к оплате" и "Ожидает дефектовку". А также "Готово к работе" - это тоже очень важный статус. В него будут попадать пересозданные таски на остаток.
            1. "Дефектовка" - параметр родительской таски потому, что хотим относить к каждому "типу работ + помещению" отдельную дефектовку (в частности, для передачи фронтов работ). Хотя было близко к тому, чтобы попасть в атрибуты помещения. А может это быть одно и то же, но с заполненным и не заполненным полем?
            2. Важно понять, как именно происходит переход статуса от "Ожидает дефектовку" к "Готово к работе". Первый ("Ожидает дефектовку") точно должен быть дефолтным статусом псевдо-тасок (то, что отображается как "статус" в боковой панели, если таска не существует). Второй ("Готово к работе") - реальным статусом тех тасок, которые имеют заполненное поле "Дефектовка" и, естественно, уже существуют.
        3. "Помещению" не досталось ничего.
4. Для каждой частичной работы, созданной системой автоматически при завершении наряда, нужен некий признак, позволяющий отличить их от частичных работ, заведенных пользователем (это нужно для того, чтобы пользователь не думал, что в его работах прежние значения, чтобы проконтролировал, что он согласен с поведением системы, новое заполнение согласуется с его пониманием, проконтролировал расхождения, сразу же внес коррективы). Если пользователь заходит в такую таску, он может отличить (где-то горит сообщение?), что данная работа была создана и заполнена автоматически, что ему теперь необходимо проверить все поля, а именно: исполнителя, объем сделанного (0), объем выданного (0 или предзаполнение значением от предыдущей саб-таски?) - как раз те, что относятся к частичной работе. Как только пользователь применил в этой работе свои значения полей, она перестает считаться сгенерированной системой либо пусть меняет статус руками.
    1. Статус работы ("Готово к работе") вполне может быть таким флагом.
    2. Вообще, можно было бы либо не трогать частичную работу и домучивать все время только одну старую работу. То есть "взять за икс" большее, и вычитать из него куски. Разошлось с текущей концепцией.
    3. Можно вообще ничего не создавать! Создавать таску уже когда чел будет снова трогать поля этой таски. Поставит слетевшего исполнителя, проставит ему "Выдано", обьемы.
5. Что есть такое цвет фасолины на примере красного (с учетом, что статус "Завершено" нас интересует за целую работу (таску), а замечания можно оставлять каждую нелелю(коррелирует с саб-тасками))? Хотим ли мы его? Да. Значит, мы хотим видеть в числе статусов родительской работы явление, происходящее с периодичностью в неделю.
6. Хотим ли мы, чтобы ячейка "Вида работ" с фасолинами закрашивалась зеленым, когда у нас одно наименование работ выполнено полностью, а все остальные - наполовину, на треть и так далее? То есть норм, что в момент закрытия наряда все ячейки будут становиться зелеными, а в понедельник снова они все будут становиться серыми? Или мы хотели бы видеть ячейку в масштабе "Вида работ" зеленой только тогда, когда все работы уже точно сделаны полностью? На самом деле, мы имеем возможность сделать одновременно и так, и так. Но нас интересует, конечно, ситуация полного выполнения.
7. Пользователю необходимо давать возможность выбрать конечную дату закрытия наряда.
8. Наряд - неизменяемая штука (ни пользователем, ни системой). ~~В ней, возможно, можно будет редактировать коммент-название и статус, но не факт, что они появятся.~~ 
9. Вложенность (или невложенность) project, storey, room_group (сейчас они вложенные): частичные работы (таски) должны убиваться и создаваться на остаток при частичном закрытии наряда. А вот Работа должна жить до тех пор, пока живут три сущности:
    1. ее этаж (в зависимости от архитекутры БД, если рум_груп вложен в этаж, то смотреть на этаже даже не нужно)
    2. ее рум_груп
    3. ее наименование работ.
    4. Зачем это? Это позволит делать удобные и более логичные селекты для сбора "всех частичных работ, относимых к данному наименованию работ в данном помещении" (потому что будет айдишник, вместо этаж + room_group + наименование работы). Это потом дополнительно позволит как-то различать разные "смены" (ночные смены или даже 3 смены в сутки - для экстренно закрываемых строительных кейсов) - несколько тасок (работ), исполняемых в один и тот же расчетный период в одном и том же помещении разными людьми. Можно, конечно, было бы прикреплять и понескольку частичных работ к помещению, но тогда как собрать только те частичные работы, которые относятся к одной смене? Концепция работы легко позволит сделать это. Кейс со сменами может быть решен иначе (через создание дополнительных этажей или дополнительных проектов), но в целом мы не против принципиально иметь возможность нескольких тасок в одной работе одновременно.
10. Как будет обнуляться статус после закрытия наряда? Сразу в WIP? нет. Пользователю надо выбрать руками правильного исполнителя? Объем работ можно всегда "обнулять"? А объем "Выдано" надо тоже вводить руками, хотя скорее всего эта цифра будет похожа на цифру в только что закрытом наряде. В общем, к вопросу о статусах - кидать должно в некий подготовительный статус, в "Готово к работе".
11. В наряды кладутся частичные работы. Больше одного раза пользователь частичную работу в наряды положить не может. Общая работа при этом может относиться к нескольким нарядам. Мы теперь даже можем собирать все наряды, которые относятся к одной и той же работе с какой-нибудь коварной продуктовой целью.
12. Дата начала расчетного периода определяется автоматически по дате закрытия последнего из предыдущих нарядов по этой же родительской-работе!.
    1. Если удаляем наряд, то удаляем все наряды, дата закрытия которых позже этого. Это просто решение кучи задач с головоной болью.
    2. Если дать пользователю выбирать обе даты, он может наотмечать там какие угодно дни и сколь угодно "дыряво". Это сложно учесть грамотно, а еще сложно объяснить пользователю, как оно работает. И там возникает очень много коллизий и все сведется к тому, что нужно честно вести табели по дням.
    3. В качестве альтернативы можно дать пользователю возможность итерироваться по расчетным периодам, но тогда надо
        1. еще где-то настройку расчетных периодов прикрутить?
        2. Сильно ограничивает пользователя. 
        3. Не такое элегантное и простое решение, как наше текущее (нравится).
    4. Предзаполнение по умолчанию: должно быть с последнего наряда по сегодня ~~или с последнего наряда + неделя~~?
13. В один момент времени в одной работе (родительской работе) может быть только одна неоплаченная частичная работа. 
14. Само существование наряда означает "оплаченность" работ в нем.
15. Если мы хотим вводить статусы нарядов (нарпример удален, оплачен, отправлен на оплату) - то это ок, но только если частичные работы все еще могуо попадать лишь в один наряд. Но пока что статусы не нужны. Надо сделать удаление наряда.
16. Удаление наряда приводит к тому, что все частичные таски, которые были созданы для него, вообще говоря больше не нужны. Чел не сможет пропустить какой-то период времени с момента последнего наряда, но и еще и невозможно без версионирования сделать новый наряд как-либо, кроме как:
    1. За те же даты - то есть восстановить наряд.
    2. С закрытия предыдущего наряда по текущий момент, будь это 3 недели или год. Если мы наудаляли столько нарядов. У нас просто по датам нет никакой првязки значений - и версионирования тоже нет. А позже с версионированием можно будет между ними (версиями с датой) прыгать.
16. Частичные оплаты могут быть очень сильно связаны с функционалом версионирования шахматки. Нам возможно потребуется кнопка для нажатия "Зафиксирвоать текущую версию" (можно еще настроить периодичность автосохранения, а можно и ручное, и автосохранение вместе). Можно будет закрывать наряд на разницу между последним закрытым нарядом и любым из сохраненных состояний шахматки. И еще при составлении наряда можно будет прикрутить автосохранение версии до и после наряда.
17. Важный момент - расценки указываются индивидуально для каждого мастера.
18. Строительные работы бывают сдельными (подавляющее большинство) и почасовыми (представлены мелкими доработками). К почасовым прибегают не на каждом объекте. Технически работа сдельщиков и часовщиков реализуется одинаково, отличие в единицах измерения - у сдельных работ это всегда час. Разделять сдельные и почасовые работы при закрытии нарядов можно через выставление фильтра по единицам измерения - в частности, делать два отдельных наряда.

5. Возникают ограничения:
    1. Сначала создается шахматка, в ней вообще нет работ. 
    2. Если уже здесь выйти на вкладку обзор - будут представлены пустые серые фасолины (по числу наименований работ в группе "Вид работ", например 5 шт) (~~подписана первая работа в этой группе? по алфавиту, не по бизнес-логике. Зачем мы показываем рандомную работу?~~). Если все фасолины статусе "ожидает дефектовку" (пустые серые) И поля в них не были заполнены, то в правой панели должна показывать заглушка про отсутствие работ.
    3. Как только хотя бы одна работа в виде работ получает заполненное поле, создается работа + частичная работа. Все "объемы" и "выдано" идут в частную работу, а значения по дефектовке должны относиться к родительской работе. Точно так же, как только хотя бы одна работа получила статус, отличный от "ожидает дефектовку", тоже создается работа + частичная работа. Каков смысл этого статуса, если цифра дефектовки не указана? Можно использовать "Готово к работе" как эвфемизм для "Ожидает дефектовку", но с проставленной дефектовкой. Тем более, довольно странно выглядит, что одна и та же серая фасолина может являться как штукой без таски, так и штукой с таской.
    4. ~~Число фасолин, кстати, вычисляется почему-то на основе работ, уже представленных в шахматке. То есть если в виде работ у нас 6 наименований работ, то 6 будут только если заполнены все 6 из них хоть где-то. Наверное, это тоже баг.~~
    5. Потом у самих фасолин начинают меняться статусы. Этот статус может стать "Готово к работе" (дефектовку мол провели), потом в работе, потом ожидает технадзор, потом замечания, потом снова в работе-ожидает_тезнадзор-замечания, так несколько раз и потом только в самом конце это должно быть "Готово". Это готово, фактически, нужно именно для вкладки "Обзор". 
    6. Поэтому статусная модель предполагается очень даже похожей.

### Предложения по БД:
1. Различать живую частичную работу от намертно зафиксированной строки в наряде. Первые, например, удаляются вместе с родительской работой, они отображают обновления в пользователях, в исполнителях, в объемах и т. д. А вторые - никогда и никак уже не изменяются - могут быть только полностью удалены при удалении наряда. Ни наряд, ни нарядная дочерняя работа не редактируемы. Родительская работа и простая дочерняя работа - меняются.
    1. Самый важный момент при этом - что пользователь может удалить работу, например, вместе со всеми частичными работами, но это не должно никак сказаться на существующих нарядах! То есть при удалении таски должны удаляться все саб-таски, а при этом "саб-таскам для нарядов" просто где-то проставляется null, если ссылка на родительсую саб-таску вообще будет там храниться!
    2. А удаление наряда, соответственно, никак не должно сказаться на существующих работах и частичных работах. Оно, правда, и сейчас на сказывается.
2. Частичная работа должна содержать (чуть ли не 4 полей должно хватить):
    1. свой id;
    2. ссылка на id родительской работы;
    3. выполненный объем ~~/расценки/всего_денег~~;
    4. выданный (запланированный) объем работ;
    4. флаг "is_paid" или дата оплаты, которая может быть null.
3. Нам бы хорошо бы в базе из room_group сделать именно планировку, а квартиры хранить отдельно. Либо переименовать room_group в rooms, и создать нормальный room_group.

### Базовые функциональные требования

1. НАРЯД:
    1. Нужны поля:
        1. Номер наряда
        2. Дата-время создания
        3. id создателя
        4. project_id
        5. Окончание расчетного периода (часто будет совпадать с полем "дата-время создания", но ровно до тех пор, пока не появится версионирование)
    2. Кажется, эти поля не нужны:
        1. ~~Начало расчетного периода (оно всегда совпадает с окончанием расчетного периода предыдущей дочерней-таски! Поэтому можем брать оттуда джоином, чтобы не вести 2 одинаковых поля в таблицах)~~
        3. ~~ФИО автора~~
        4. ~~Должность автора~~
        5. ~~Статус (сформирован, оплачен, удален)~~
        6. ~~Название наряда~~
    3. Какие поля отображать в списке нарядов:
        1. Номер
        2. Дата создания
        3. Дата создания предыдущего наряда по этой работе
        4. Автор (ФИО + Должность)
2. РАБОТА (таска):
    1. свой_id
    2. room_group_id
    3. ~~Название помещения - строка, например "Квартира" / "МОП" / "ЛК" / "ЛХ" / "Вестибюль"~~. (возможно достать по work_id).
    4. ~~Этаж (нужен только если room_group - это определенная планировка на этаже, а не конкретная квартира).~~ Помещения достаточно.
    5. ~~project_id?~~ Помещения достаточно.
    6. Всего - дефектовка
    7. ~~Имя работы как в ведомостях~~ (возможно достать по work_id)
    8. ~~Имя работы как в 1С~~ (возможно достать по work_id)
    9. work_id
2. ЧАСТИЧНАЯ РАБОТА В ШАХМАТКЕ (саб-таска):
    1. Частичная работа не может же быть отрицательной и пр. - описать ограничения на поля правой боковой панели.
    2. Важно отличать частичную работу от частичной работы, зафиксированной в наряде (payment_report_task). К сожалению, нужен дубль. Почему их нельзя объединять? Потому что что work_name и select-join name по work_id будут разными! Также удаление этажей не должно аффектить наряды, а также просто из соображений удобства и нормализации БД. А еще в частичных работах в наряде будут сохранены куски данных, подтянутые из родительских тасок.
    3. Нужны поля для частичной работы:
        1. id_исполнителя
        2. id_работы (которая родительская таска, а в ней уже будут ссылки и на работу как в шахматке/ведомостях, и как в 1С заказчика, и единицы измерения, и дефектовка, и подтаскивание всех предыдущих частичных работ для высчитывания того, что готово и так далее);
        3. "Выполненный объем"
        4. "Выдано"
        5. paid_at - когда эта дочерняя таска была оплачена? может быть null - и тогда это последняя атуальная частичная работа, в которой сейчас ведется активная работа.
        6. ~~id наряда, в которых он попал?~~
    4. Хотя мы очень хотим разнести частичные работы и частичные работы в наряде, необходимо корректно обрабатывать ситуацию, когда наряд отправляется в коризину. Его присовокупленные таски должны удаляться или потерять некий статус об оплате? Поинт в том, что это может по идее аффектить текущую последнюю тасочку. Или нет?
        2. Либо нафиг удалиться, если нам неважно, кто и чего раньше делал.
        3. ~~либо потерять статус is_Paid, если нам захочется потом как-то восстановить историю.~~ - не надо восстанавливать пока, мы пожалеем, т.к. все замусорим. Это должен быть острыц рабочий инструмент.
    4. Расценка - берутся из таблицы с расценками, в которых select будет делаться по id_исполнителя и id_работы.
3. ЧАСТИЧНАЯ РАБОТА В НАРЯДЕ (слепок саб-таски, таски и других таблиц системы в момент закрытия наряда; в наряде составит одну строку):
    1. Сейчас в наряд попадут работы, у которых:
        1. в саб-таске указан Исполнитель,
        2. в саб-таске указан Выполненный объём
        3. в таске указан правильный статус "readyToPay" или "completed":
            1. "readyToPay" закроет саб-таску в этом наряде и создаст новую саб-таску на остаток;
            2. "completed" закроет саб-таску в этом наряде.
                1. Если задачка попала в completed, то при редактировании полей пользователем у нее снова создастся в БД новая саб-таска в этой же самой таске. И пусть даже у нее будет статус изначально complete - создаваться она может. Главное условие - вмешательство пользователя. Если пользователь ничего не трогает, пусть система саб-таску на остаток не создает.
        3. саб-таска не попадала в сформированные ранее наряды - а значит, ее paid_at is null.
    1. Примерный состав полей (все фиксируются на момент закрытия наряда):
        1. Исполнитель / Сотрудник (строка) - из саб-таски
        2. Вид работ / Вид работ по ведомости (строка) - через таску
        3. Вид работ по 1С (строка) - потом потребуется - через таску
        4. Единица измерения (строка) - выносятся отдельно ради сортировки и фильтрации - через таску
        5. Помещение (строка) - из таски
        6. Этаж (строка) - из таски
        7. Объем выполненных работ - из саб-таски
        8. "Всего" (дефектовка, float) - из таски
        9. (Процентовка - высчитывается!) - back-end
        10. (Остаток - высчитывается!) - back-end
        11. Расценка - из других таблиц?
        12. (К выплате - высчитывается!) - back-end
        13. Свой собственный id
        14. id наряда, в которых он попал - из саб-таски?
    3. При удалении нарядов
        1. Хотим ли мы нафиг удалять все частичные работы в наряде? ~~Или они останутся загрязнять БД навечно, мертвым грузом?~~
        2. ~~либо вариант, что они теряют статус is_Paid или что-то в таком духе, если нам захочется потом как-то восстановить историю. Крайне сомнительная история.~~
4. В нарядах должны быть сортировка и фильтрация. Пусть все будут по алфавиту, чтобы не париться. 
5. Когда наряд удаляется...

### Backlog

1. Добавить возможность редактировать "Название наряда": добавить поле "Комментарий".
2. Темы с импортом, с экспортом, со скачиванием xlsx и pdf. Печатные формы вообще работа с документами. Нужен системный подход к печати всех доков в продукте.
3. Нужно брать версионирование, потому что после него наряды, вполне вероятно, частично изменятся. Версия - слепок шахматки на момент времени. Закрываемый наряд сможет позже вычислять разницу объемов между нынешними состоянием и отраженным в последнем наряде (позже разницу всех значений шахматок), а потом уже обрамлять это в формат наряда.
4. У работ в группе "Вид работ" нет сейчас бизнес-сортировки, она в целом нужна. Наверное, отдельной фичей.

### E2E иллюстрация

1. У пользователя есть закрытие расчетные периоды 1, 2, 3, 4 и он только что закрыл период 5. При этом, если удалить один из предыдущих нарядов, например, 2, то просто предупреждаем, что наряды, закрытые на после этого (а именно, 3, 4) тоже отправятся в удаленные (могут остаться доступны для просмотра?). Если они и будут доступны для просмотра, то во всяком случае больше никогда не попадут в расчеты - и следующий за нарядом №1 сразу будет наряд №6 за периоды 2-5.
    1. Чтобы корректно посчтитать разницу в объемах сделанных работ, нужно хранить слепок всех прежних частичных работ (саб-тасок) и их обрабатывать. Мы этого, во-первых, не хотим, а во-вторых, не можем, так как по итогу упирается либо в ведение учета работ как минимум посуточно, либо упирается в ежедневное автоматическое версионирование.
    2. Поэтому единственной возможностью будет закрыть наряд на разность между **текущим** состоянием шахматки и **теми объемами, что были в последнем успешном наряде**.