# Пользователи, исполнители, технадзоры, <br> должности, доступы, приглашения

<br>

## Введение (проблематика):

> В бизнес-логике системы представлены сущности, которые не являются зарегистрированными (авторизованными) пользователями, а являются, скорее, **контактами** (неавторизованными пользователями, dummy-пользователями, кандидатами в пользователи). И **контакты**, и **пользователи** соответствуют реальным людям - в частности, имеют атрибуты "ФИО" и "Телефон".
>   - **Контактами** могут являться исполнители и технадзоры, которых просто внесли в списки шахматок "Исполнители" и "Технадзоры", но которые сами не являются пользователями (т.е., это "атрибут" шахматки).  
>
>   - **Пользователями** могут являться прорабы и технадзоры, ведущие операционную деятельность в шахматке ("субъекты" по отношению к шахматке).  
>
> > Отсюда видно, что, как минимум, **технадзоры не позволяют полностью отделить пользователей от контактов** - список "Технадзор" в шахматке не подразумевает подтягивание данных из разных мест БД и сложную логику для их обработки, избежания дублей и т. д.

<br>

Решение 1: Разделение
> Минусы решения, в котором всех исполнителей (рабочий, бригадир) причисляют к **Контактам**, а основных пользователей (прораб/мастер участка/технадзор/начальник участка/др.) - к **Пользователям**:
> - вопрос с технадзорами (см. выше, с остальными при желании можно было продолжить); 
> - есть шанс запутать пользователя: вопрос либо перетекания контактов в пользователи + мерджа пользователей (когда аналогичный пользователь заводится из другого справочника), либо конфликнтый пользовательский опыт многократного использования одного и того же номера телефона в системе в разных ипостасях (шахматку меняет редактор-пользователь, а в списках он же значится просто как текст);
> - вопрос корректировки пользователем своих данных и невозможности подтягивания данной информации в списки шахматки;
> - плодим сущности без надобности с точки зрения БД, создаем много дублей (но это не критично);
> - затруднение дальнейшего сбора статистики и анализа; 
> - все равно надо будет вести таблицу, в которой записаны те же исполнители с привязкой к конкретному проекту (шахматке). Объем его будет сопоставим или больше, чем база никнеймов (алиасов): если никнейм в каждом проекте свой, то объем похож, а если никнеймы привязывать только к пользователю - то никнеймы даже выигрывают;
> 
> Аргументы за:
> - Простота реализации;
> - Мобильного приложения для рабочего, по всей видимости, не предвидится.

<br>

Решение 2: Единая база пользователей, сквозное отображение имен
> Другой вариант - мы вообще не отличаем **пользователей** от **контактов** и храним их в одной таблице в БД, отражение ФИО в системе сквозное. Возникают вопросы:
>   - Нормально ли явление коллективного редактирование имени? Это ведет к:
>     - потере пользовательских данных;
>     - путанице при использовании.
>   - Даже если коллективное редактирование для нас ОК, то кто именно вправе задавать сквозное имя для такого пользователя-контакта (его в разных шахматках вписывают в свои списки разные пользователи) - все, никто, система? Какое имя более правильное - первое или последнее? И пр.
>   - Можем ли мы распространять чувствительные данных по фио, телефону, телеграму и пр.?
> 
> Аргументы за:
> - Простота реализации;
> - Простота для пользователя.

## Вывод:

Решение 3: Никнеймы (алиасы)
> Ввод никнеймов в систему (говорим пока о ФИО и, возможно, о должности).  
> 
> **Плюсы**:  
> - Никнеймы потребовались бы, даже если **контакты** хранить отдельно от **пользователей** - сквозное изменение имен все равно проявилось бы для пользователей-технадзоров.  
> - Для реализации никнеймов необходима всего одна таблица, хранящая связь "ФИО данного пользователя для другого пользователя" или "Должность данного пользователя для другого пользователя". 
> - ~~Уже есть таблица, связывающая проект и пользователя - **project_role**. Смысл ее совсем другой (управление доступами), но при желании возможно добавить в эту связь "ФИО данного пользователя в данном проекте" и "Должность данного пользователя в данном проекте"~~.  
> - Никнеймы решат проблемы разных отображений имени в системе - то тремя полями, то одним полем. Тремя полями заполняем user (доступно только на экране "Учетная запись") и не показываем пока нигде, а одним полем - во всех остальных местах - в доступах, списках и т. д. (но можно было бы и перейти к одному и там, и там)
> - Если потребуется, на основе никнеймов возможно будет решить проблему управления доступами к контактным данным пользователей (один пользователь видит основной работчий email технадзора, который сам и ввел, другой - личный email, третий - не видит ничего и т. д.);
> 
> **Минус**:  
> - Возможность видеть чужие никнеймы для знакомого мне пользователя (избыточность).  
> "Я записал Васю у себя как Василия Иванова и при этом смотрю в чужую шахматку, где он же записан как Василуалий Иванкевич. Я могу не сообразить, что речь идет об одном и том же человеке. Однако, ради создания в чужой шахматке единообразных нарядов и реестров, которые будут в коллективном пользовании у всех редакторов, я обязан в чужой шахматке видеть имена людей ровно так, как они записаны у создателя шахматки (либо как отражено в 1С, но это потом). Такая особенность есть только у имен; остальные данные (почта, зарплата, телеграм, семейный статус и прочее) - пользователь видит так, как знает из-под своего аккаунта). Если появится карточка пользователя, в ней теоретически можно будет отразить "мой никнейм", "никнейм в проекте" и пр."
> 
> Изменения в таблицу никнеймов (или другое место хранения никнеймов) могут вносить создатель проекта (шахматки) и редакторы проекта.  

## Предложения:

### Основные тезисы по типам пользователей:

> - **Контакты и пользователи** с точки зрения архитектуры не различимы;
> - "ФИО" ~~и "Должность"~~ пользователя в системе отображаются как алиасы - для каждого пользователя свои;
> - Для этого необходимо сделать таблицу, которая будет содержать отражение реальных системных пользователей на профиль текущего пользователя (кажется, нет смысла привязыват к каждому отдельному проекту);
> - Мы не хотим заставлять пользователей вести учет Фамилий, Имен и Отчеств, поэтому предлагается везде в интерфейсах перейти к единому полю - "ФИО" (а в разделе "Мой профиль" можно как поменять, так и оставить три поля, потому что таблица никнеймов позволяет это провернуть. Давайте пока оставим три поля).

### Основные тезисы по доступам:

> - "Чтение". Могут просматривать шахматку (объемы работ, исполнители, этажи), просматривать списки (справочники), просматривать наряды, просматривать все замечания. Могут создавать, менять и удалять свои замечания. Не видят доступы.
> - "Редактирование". Все то же, что "Чтение", плюс: редактировать шахматку, редактировать справочники и наряды (в т. ч. настраивать чужие никнеймы), создавать/редактировать свои замечания, а также менять статусы чужих замечаний. Могут редактировать доступы.
> - "Владелец". Создатель шахматки может делать все, в том числе редактировать и удалять чужие замечания и настраивать доступы.
> - ~~Человек сейчас может самовыпилиться из доступов, но это ок.~~

<br>

**Общая структура доступов**

| Функциональность                | Действия                                           | RE | ED | OW |
| ------------------------------- | -------------------------------------------------- | -- | -- | -- |
| Замечания                       | Просмотр чужих замечаний                           | +  | +  | +  |
|                                 | Смена статуса чужих замечаний                      |    | +  | +  |
|                                 | Создание, редактирование, удаление своих замечаний |    | +  | +  |
|                                 | Редактирование чужих замечаний                     |    |    | +  |
| Шахматки (статусы, объем работ) | Просмотр шахматки                    | +  | +  | +  |
|                                 | - Редактирование шахматки            |    | +  | +  |
| Списки (справочники)            | Просмотр                             |    | +  | +  |
|                                 | - Создание, редактирование, удаление |    | +  | +  |
| Наряды и реестры                | Просмотр                             | +  | +  | +  |
|                                 | - Создание, удаление, просмотр       |    | +  | +  |
| Доступы                         | Управление доступами                 |    | +  | +  |

### Дополнительные тезисы:

> - Доступы необходимо отвязать от должностей пользователей.
> - В одном и том же помещении могут быть замечания, оставленные разными технадзорами (т. е. разными пользователями с доступом редактирования). Какая-либо связь комментирующих пользователей с тем технадзором, который "закреплен" за помещением в шахматке (в боковой панели справа), технически отсутсвтует.
> - **Для каждого среза работ должны быть свои замечания**. Необходимо предусмотреть переключение между видами работ для замечаний (хотим мы работу/вид работы выбирать на экране замечаний либо хотим изначально навигироваться по работам, а замечания вынести в **Панель действий**). 
> - Вообще говоря, человек на двух объектах, тем более в разных должностях - кейс практически нереальный, и это аргумент в пользу задать job_title как сквозной атрибут пользователя. Но тогда должность, которая идет часто рядом с ФИО, будет самопроизвольно меняться, в то время как ФИО - не будет. Поэтому по итогу лучше относить должности тоже в **user_alias**. С должностями надо подумать, надо ли заморачиваться, но их отражение в системе желательно.

<br>

### Data base

<br>

> - Необходимо отвязать понятие "Должность" от доступов пользователей (role):  
Из таблицы  **project_role** убрать все записи, кроме "Чтение" и "Редактирование". Почти все остальные строки необходимо вынести в отдельную таблицу с должностями (напр., **user_job_title_d**, справочник, см. ниже) - либо просто иметь ее в виду и создать, когда станет необходима. В этой же таблице **project_role** нужно удалить поле (**status**) (это legacy). 
>  
> - В таблице **user** нужно убрать поля gender, status, comment и добавить поле job_title с uuid должности из справочника **user_job_title_d** (или строка, если не хотим заводить словарь). 
> - Необходимо реализовать новую таблицу для никнеймов (см. **user_alias** ниже). Поля в нем повторяют таблицу **user**, однако вместо полей first_name, middle_name, last_name необходимо использовать одно поле - full_name.
> - Таблицу **permissions**, вероятно, необходимо дропнуть (role и permissions вдвоем доставляют очень близкий по смыслу функционал регулирования доступов - мы имеем возможность и желание от этого дробления уйти).
> - Таблицу **role_permission**, вероятно, необходимо дропнуть.  
>
> - Предлагается в таблицах **role** ~~и **permission**~~ перейти в айдишниках от _serial4_ в пользу _uuid_.  
> - ~~В будущем у исполнителей может быть словарь из своих должностей: "бригадир" и "рабочий" (пока можно просто иметь в виду)~~.
> - Также далить поле _code_ в таблице **role**, перейти от serial4 к uuid и другие предложения (см. ниже).

<br>

### Back-end

<br>

> - Из настройки доступов, технадзоров и исполнителей информация (обычно это "ФИО" и "Должность") сохраняется в таблице с названием вроде **user_alias**. Телефон лучше хранить в основной таблице - **user**.
> - В экране "Моя учетная запись" добавить и сохранять поле "Должность".
> - При сохранении данных из экрана "Моя учетная запись" информация сохраняется в user.
> - Необходимо для редакторов и создателя шахматки добавить возможность корректировки исполнителя в справочнике проекта "Исполнители" без удаления строки.
> - Необходимо для редакторов и создателя шахматки добавить возможность корректировки технадзора в справочнике проекта "Технадзоры" без удаления строки.

<br>

### Design + Front-end

<br>

> - В экране "Мой профиль": необходимо добавить поле "Должность" на front-end в виде селектора (справочника) с единичным выбором;  
> - В экране "Настройка доступов" поле "Роль" переименовать в "Должность".
> - В экране "Редактирование спика ХХХ": когда на проект добавляется новый технадзор или исполнитель, при вводе номера телефона пользователь должен заранее видеть, как зовут в системе этого человека (поиск по таблицам user и worker).
> - Необходимо добавить возможность корректировки исполнителя - без удаления строки. Разлочить поля на фронт-енд.
> 

<br>

## Предложения по изменению в БД:

### Таблица user

_Изменение состава полей_

| Как сейчас:              | Как предлагается сделать:   | Комментарий |
| ------------------------ | --------------------------- | ----------- |
| id                       | id                          |             |
| first_name               | first_name                  |             |
| middle_name              | middle_name                 |             |
| last_name                | last_name                   |             |
| email                    | email                       |             |
| phone                    | phone                       |             |
| pic                      | pic                         |             |
| **status**               |                             |             |
| created                  | created                     |             |
| updated                  | updated                     |             |
| last_login               | last_login                  |             |
| **login**                | **(login?)**                |             |
| **pwd**                  | **(pwd?)**                  |             |
| **salt**                 | **(salt?)**                 |             |
| **password_set_by_user** | **(password_set_by_user?)** |             |
| **gender**               |                             |             |
| **comment**              |            | Комментарий в свободной форме|
| telegram_id              | telegram_id                 |             |
| last_project_id          | last_project_id             |             |
|                          | job_title                   | Вместо таблицы **project_role** |

Сюда же можно прикрепить идентификатор в 1С на будущее (идентификатор "Исполниитель") - тогда можно и в другие таблицы поле для идентификатора "Проект" и идентификатора "Работа" добавлять.

<br> 

### Таблица user_alias (привязка пользователя к пользователям)

_Новая таблица_

| Как предлагается:   | Комментарий |
| ------------------- | -------------- |
| alias_uuid          | not null       |
| user_uuid           | **who**, not null |
| account_owner_uuid  | **to whom**, not null |
| full_name           | **FIO alias**, not null |
| email               |        |
| ~~phone~~           | ~~not null, но лежит в оригинальной таблице~~ |
| telegram_id         |                |
| job_title           | **job alias** |
| comment | Комментарий в свободной форме: "всегда пропадают мешалки", varсhar(255)|
| created             |                |
| updated             |                |

1. Рабочий может быть записан исполнителем на нескольких шахматках, и поэтому в таблице **worker_project** может быть несколько записей с совпадающими ФИО, телефоном, телеграмом и почтой, но разными project_uuid.  
2. Это нужно для того, чтобы: разные содатели могли именовать исполнителя по-разному в своих шахматках, а также чтобы переименование исполнителя одним пользователем не отражалось на шахматках других пользователей.  

<br> 


### Таблица permissions

_Удаление таблицы_

<br> 

### Таблица role_permission

_Удаление таблицы_

<br> 

### Таблица project_role

_Предложение по составу полей_
- Накаких статусов, кроме "активно", у записей нет, поэтому статус можно удалить, а при смене роли пользователя делать UPDATE существующей записи?

_Изменение состава полей_  

| Как сейчас: | Как предлагается: |
| ----------- | ----------------- |
| id          | id                |
| **status**  |                   |
| project_id  | project_id        |
| role_id     | role_id           |
| user_id     | user_id           |
| comment     | comment           |
| created     | created           |`
| updated     | updated           |

<br> 

### Таблица role

_Предложение по составу полей_
- Перейти от serial4 к uuid?
- Удалить поле code?

_Изменение содержимого_
- убрать все, кроме редактора и читателя
- в целом, предполагается также роль "Создатель" - но мы ее отдельно не формализуем, она дает доступ до настроек профиля, создания/удаления объектов, а также редактирования/удаления всех заметок, даже чужих.

| id  | name     | code |
| --- | -------- | ---- |
| 18  | Читатель | RE   |
| 19  | Редактор | ED   |

<br> 

### Таблица user_job_title_d

_Новая таблица_  (отделилась от **role**). Возможно создать ее попозже или даже указывать должности строками, без использования данного словаря.

- Сразу uuid?
- Не переиспользовать поле code?
- Наполнение: ниже приведены должности, которые нужно будет отразить в селекторе на front-end и, соответственно, положить в таблицу user_job_titles:

| Должность          |
| ------------------ |
| Начальник участка  |
| Прораб             |
| Технический надзор |
| Мастер участка     |
| Сметчик            |
| Инженер ПТО        |
| Рабочий            |
| Бригадир           |

### Проблема 1

**Требуется сложное разграничение доступов, не только по принципу "право на просмотр" / "право редактировать любые разделы"**.  
На одном проекте один и тот же пользователь Х может быть технадзором (оставлять замечания и производить приемку), на другом проекте - фигурировать как исполнитель работ.  
При этом, если пользователь - технадзор на двух проектах, на одном проекте может быть доступ с правом редактирования работ в помещениях (+ заметки), на другом - доступ с правом только на чтение шахматки (+ заметки).  
Если пользователь системы - исполнитель на нескольких проектах (так будет редко, и тогда он все равно по факту и.о. прораба), ему на разных проектах могут выдать доступ с разными правами:

- редактирования шахматки
- редактирования шахматки и справочников (работ, исполнителей), данных дефектовки и др. (бригадир)
- только на перевод работы в статус завершена
- с правом только на просмотр
- другие комбинации.

### Решение 1

1. Cистема должна предоставлять пользователю возможность **гибко настраиваить все доступы для всех пользователей**, являющихся участниками проекта, кроме себя.
2. Cистема должна предоставлять пользователю возможность удобно **просматривать данные по доступам** на проекте.
3. Система должна давать возможность проставлять должности пользователям и dummy-пользователям.
4. Система должна давать возможность просматривать должности пользователей и dummy-пользователям.
5. Должность пользователя напрямую жестко не связана с доступом к функционалу (связь подразуемевается, но не форсируется).
6. При создании пользователя и выборе ему должности права доступа автоматически предзаполняются!
7. В дальнейшем права доступа каждого из пользователей могут быть скорректированы.
8. Доступы существуют только в контексте данного объекта.

Возможная реализация:

- в разделе управления доступами к шахматке представлены категории функциональности;
  - в каждую категорию функциональности можно провалиться и увидеть перечень пользователей, имеющих к ней доступ;
    - в перечне пользователей для каждого пользоватея указываются
      - Телефон
      - ФИО
      - "Должность/Роль"
      - "Комментарий" (видны ± первые 50 символов)
      - Является ли пользователем ("Пользователь" / " " - flag, а может, просто иконка каски, например. потом сможет отображать онлайновость пользователей)
      - ~~измерение, по которому уже и произведена фильтрация - это сами доступы. Это набор из 8 флагов) 
  - в перечене категорий функционала должна быть отражена группа, в которую внесены все НЕ-пользователи и пользователи без доступа к шахматке (т.е. можно быть пользователем, числиться на объекте и при этом не иметь никаких доступов) - функционала у этой группы нет никакого, даже просмотра;
  - в каждой категории функциональности можно добавлять и удалять пользователей, имеющих к ней доступ.
  - ~~в каждого пользователя далее можно провалиться и увидеть профиль со сводной информацией по нему: телефон, ФИО, доступы, должность, комментарий~~
- система поддерживает отображение в виде перечня пользователей, с фильтрацией(поиском);
  - ~~из общего перечня пользователей можно также провалиться в пользователя и увидеть профиль со сводной информацией по нему~~.


У каждого пользователя системы есть поля "Должность" и "Является ли пользователем". В зависимости от их комбинации есть несколько вариантов дефолтного доступа:

Если кто-то не является пользователем, то он не может в системе ничего.
Если "Контакт" тел_1 имеет ссылку на шахматку, он все еще не может ее просмотреть, просто зарегистрировавшись - для этого ему должны быть выданы минимальные права.
Все Контакты, прикрепленные к проекту, зарегистрировавшись, смогут просматривать шахматку (над которой они и работают).
Но в редкатировании справочника исполнители - должно быть четко написано, что вот мол эти люди будут видеть шахматку.

В таблице считаем, что все, кто не прикреплены к объекту через списки (справочники), могут иметь доступ только к просмотру шахматок (со статусами и объемами работ) и к замечаниям.

При этом создатель шахматки всегда может делать все, вплоть до нарядов/реестров и списков

| Должность   | Что может по умолчанию | Комментарий |
|---------------------|----------------------|-----------|
| Контакт (unregistered) | Не может ничего. Может только зарегистрироваться. | - |
| Исполнитель (workman)  | Просмотр чужих шахматок (со статусами и объемами работ) и замечаний | Рабочие будут редко регаться, но если вдруг зарегистрируются, они смогут только читать и менять статус работ, и только если принадлежать к проекту |
| Пользователь или Прораб или Нач. уч. или Технадзор (user, foreman, techman, etc)| Может делать все с чужими шахматками и замечаниями. Работа с нарядами/реестрами и с списками - только по доступу создателя шахматки| |
| ИО (manager) | Режим полной свободны. Может делать с шахматкой все. Не может удалить объект. Не может редактировать наряды и реестры (никто не может). Может выдавать и забирать доступы, кроме создателя, у него на все карт-бланш всегда. |

Могу только я (создатель):
- создание и удаление шахматок в моем профиле
- Пользовательские (свои) настройки меняют только я
- Редактировать наряды и реестры нельзя вообще никому. Даже система этого делать не умеет. Можно только перейти в предыдущую версию и создать новый отчет на ту же дату.

| Функциональность | Комментарий | Кому дефолтно выдаются |
|--------------------|---------------------------------------------------------------------|----|
| Замечания          | Просмотр                                                            | Технадзор |
|                    | - Создание, редактирование (в том управление файламии), удаление замечаний, смена статуса замечания |
| Шахматки (статус и объем работ) | Просмотр                                                            |
|                    | - редактирование                                |
| Списки (aka справочники) | Просмотр                                                      |
|                    | - Создание, редактирование, удаление                                |
| Наряды и реестры   | Просмотр                                                            |
|                    | - Создание, удаление                                |





Только я и создатель шахматки можем создавать замечания и закрывать их. Другие замечания просматривают.
При этом если я исполнитель, то только я и создатель шахматки можем создавать работы и закрывать их. Другие работы просматривают.
Наряды и отчеты вообще никто, кроме пользователя, не видит.

**Проблема 2**: сквозные данные по ФИО - путают пользователяю, потому что это коллективное редактирование.
С точки зрения системы, оно должно быть

**Проблема 3**: чувствительные данные - я может даже и не хочу, чтобы мои данные кто-то видел, кроме начальника-прораба.

Что такое есть должность в нашей системе?
Не более, чем комментарий сейчас. Привязать разграничение доступов к должности можно, но нужно ли?
Так или иначе, лучше словарь должностей завести, если эта должность так уж нужна.
Нужен ли нам внутренний комментарий по всем нашим исполнителям?

Ролевая модель в системе на текущий момент отсутствует. То есть:
Пользователи никак не отличаются в системе друг от друга, даже если обладают разными должностями (прораб, начальник участка, технадзор, бригадир, мастер участка и др.). Во-первых, их функции могут меняться со временем, во-вторых иногда они совмещают разную деятельность. Например, Пользователь может быть
одновременно прорабом и технадзором, не говоря уже о разных ролях на разных объектах.

Основные функции, доступные любому пользователию в своем аккаунте - CRUD-операции для шахматок, нарядов/отчетов/реестров, справочников (работы, технадзоры, исполнители), замечаний, настройка (аккаунт, статусы, виды работ).

При этом надо понимать, что пользователь при формировании реестров на выплату все равно узнает ФИО работников. А вот работникам знать друг друга совсем не обязательно?

Могу ли я как пользователь видеть чувствительные данные исполнителей в шахматках, к которым у меня доступ на чтение? На редактирование?

| Кто | Что хочет | Для чего |
|-----|------|-------|
||||
|| Работа со своими шахматками ||
||||
| User | (!) Видеть полные ФИО своих исполнителей        | Формирование корректных нарядов, реестров, других документов |
| User | (!) Не вводить вручную ФИО своих исполнителей   | Ускорение и упрощение работы с продуктом                     |
| User | Совершать CRUD-операции над справочниками (работ, технадзоров, исполнителей) | Выполнение базовых действий с шахматкой, замечаниями, нарядами |
|      | - Изменять данные исполнителей                | Поддержка актуальной контактной информации - исполнители       |
|      | - Изменять данные технадзоров                 | Поддержка актуальной контактной информации - технадзор         |
| User | Совершать CRUD-операции над шахматками        | Базовая работа с шахматкой                                     |
| User | Совершать CRUD-операции над нарядами          | Базовая работа с нарядами                                      |
| User | Совершать CRUD-операции над замечаниями       | Базовая работа с замечаниями                                   |
| User | (!) НЕ изменяемость моих шахматок третьими лицами  | Не путаться, не терять реальные данные и не подозревать систему в скомпрометирвоанности |
| User | (!) Изменяемость моих шахматок третьими лицами     | Актуализация данных |
| User | (!) НЕ изменяемость моих замечаний третьими лицами | Не путаться, не терять реальные данные и не подозревать систему в скомпрометирвоанности |
| User | (!) Изменяемость моих замечаний третьими лицами    | Актуализация данных                                       |
| User | Давать возможность оставлять замечания как технадзору, так и исполнителю (бригадиру, например) | ?             |
| User | Давать возможность редактировать работы как исполнителю, так и технадзору                      | ?             |
| User | Изменять свои пользовательские настройки           | Поддержка актуальной контактной информации (своей) и персонализация |
| User | НЕ изменяемость моих настроек третьими лицами      | Не путаться, не терять реальные данные и не подозревать систему в скомпрометированности |
| User | Импортировать контакты из телефонной книги         | Быстрое заполнение справочников                         |
| User | Назначать себя исполнителем                        | Для удобства                                            |
| User | Назначать себя тезнадзором                         | Для удобства                                            |
| User | Назначать исполнителем dummy-пользователей         | Для упрощения/ускорения/удобства работы                 |
| User | Назначать исполнителем других пользователей        | Для избежания дублей между dummy- и full-пользователями |

| User | Создавать dummy-исполнителей                       | Для операционного учета, когда телефон человек неизвестен или его ФИО неизвестны, но создать надо |
| System | Превращать dummy-исполнителей в настоящих пользователей | Для того, чтобы впоследствии однозначно идентифицировать и анализировать связи людей, а еще если у нас телефон - не только логин, но и ключ к просто сущности, могут случиться перепутаница в ...  |
право выдавать доступы
|
||||
|| Смотрю чужие шахматки - просмотр ||
||||
| User | НЕ изменяемость моих настроек третьими лицами | Не путаться, не терять реальные данные и не подозревать систему в скомпрометирвоанности |

||||
|| Смотрю чужие шахматки - редактирование ||
||||

||||
|| Другие смотрям мои шахматки - просмотр ||
||||
||||
|| Другие смотрям мои шахматки - редактирование ||
||||
| Non-user | НЕ видимость моих данных никому, кроме непосредственного руководителя/прораба !!! | Сохранение конфиденциальности        |
| Non-user | Видимость моих данных всем                                                    !!! | Оперативное решение рабочих вопросов |
| System | Обеспечить возможность передавать все данные пользователей третьим лицам в неограниченном количестве | Юридическая чистота |

Пользователь всегда может менять свои системные настройки
Пользователь никогда может менять чужие системные настройки
При этом пользователь хочет всегда помечать другие телефоны так, как удобно ему. При этом чем ближе этот никнейм к реальному имени, тем меньше проблем с документами.
Но и бегать уточнять, как кого зовут, пользователь не хочет. Он хочет обозвать исполнителя как угодно. Потому через интеграцию с 1С надо нужны будут реальные имена.
Я могу хотеть дать возможность исполнителю вносить правки в работы на шахматке, но не вносить в замечания
Я могу хотеть дать возможность технадзорв вносить правки в замечния на шахматке, но не вносить в работы
Корректировать замечания может только их создатель или создатель шахматки.
Права на редактирование справочников должно быть отдельной вещью. Особенно работ



=============

> - Один и тот же номер телефона может встречаться в системе много раз - он может быть указан разными пользователями в своих шахматках. 
> - Один и тот же номер телефона может встречаться в рамках одного проекта несколько раз - его могут указать и как технадзора, и как исполнителя - почему нет.
> - Люди становятся пользователями при первом входе в систему (как в случае самостоятельной регистрации, так и при получении приглашения).
> - В качестве технадзора и исполнителя можно ставить пользователей, а можно - контакты.
>   - В таблице, хранящей исполнителей, несколько записей может быть связано с одним и тем же человеком. Одноко в рамка одного проекта исполнители (номера телефонов) уникальны, т. е. комбинацией "project_uuid + phone" является для таблицы уникальной (это предложение).
> - Как только технадзор регистрируется в системе, он должен стать пользователем и быть помещен в таблицу user. Его имя станет сквозным для всех. Какое имя будет отражено у всех, кто его задействовал в своих шахматках? А какую из данных ему кличек он сам увидит у себя?
> - В экране "Мой профиль": заменить "Фамилию", "Имя", "Отчество" на одно обязательное поле - "ФИО"  - для предсказуемого с точки зрения пользователя поведения системы. 