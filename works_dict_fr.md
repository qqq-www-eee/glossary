### Используемые понятия

1. **Наименование работы** - обозначение для строительной работы, доступной в данной шахматке (доступной к исполнению на объекте).
2. **Вид работ** (частный случай группы работ) - несколько наименований работ, объединенных пользователем по какому-то принципу в группу. Отображается в UI как папка. Сейчас система позволяет создавать только один уровень вложенности, по бизнесу соответствующий "Виду работ".
3. **Работа** (таска) - задача по проведению конкретного наименования работ для данного исполнителя в определенном помещении.
4. **Список работ** - название раздела web- и мобильного приложения, отвечающего за настройку переченя работ в шахматке (работ на объекте).
5. **Системный список работ** - универсальный справочник, содержащий все работы, когда-либо введенные пользователями системы в свои шахматки. Из него пользователь выбирает работы для шахматки, пользуясь поиском.
6. **Список работ шахматки** - перечень наименований работ данного объекта (шахматки).  
~~5. **Пользовательский список работ** - перечень наименований работ, доступных данному пользователю. Из них пользователь выбирает наименования работ для своих шахматок.~~  
~~7. **Дефолтный список работ** - универсальный стартовый шаблон, порождающий пользовательский список работ на старте взаимодействия пользователя с системой.~~

### Макеты

1. [Стартовый экран - список работ шахматки не настроен](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a3db0baa7996b68f10):
    - слева - **область системных работ** ~~**область пользовательских работ**~~;
    - справа - **область работ шахматки**.
2. [Список работ шахматки настроен](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a7f602847abe046714).

### Предложения по БД

1. Таблицу work отдать под список работ шахматки.  
2. Новую таблицу (напр. sys_work_list) создать под пользовательский список работ.

> Если привязывать работу к sys_work_list вместо work, получается soft-delete для работ - при удалении работы из work работа (task) все еще будет ссылаться на корректное наименование в sys_work_list, данные не потеряются. При добавлении работы назад все заресторится.
> Но во-первых мы не хотим перегружать логику пользователю.  
> Во-вторых, у пользователя будет версионирование и откат.
> В-третьих, если связанные с наименованием работы таски не перестанут существовать, она могут продолжить появляться в нарядах. Тогда у работы должен быть либо дополнительный статус "Удалена" (но статус работы - это ж немного про другое), поэтому предлагается просто все честно удалять. 
> Так что удаляем жестко. Если пользователю очень надо, пусть держит наименование работ дальше.

### Функциональные требования

7. Первый вход в раздел "Список работ":
    1. При создании нового пользователя для него создается сущность "пользовательский список работ" (строки в sys_work_list), в него кладется "дефолтный список работ" ([сам список тут](/Дефолтные-работы.pdf)).
    2. При переходе в шахматку: если список работ этой шахматки не настроен, система предлагает пользователю его настроить (создать), т.е. для каждой шахматки пользователь создает отдельный список работ шахматки.
    3. При переходе в шахматку: если список работ этой шахматки настроен, пользователь может отредактировать список работ шахматки.
    4. По дефолту на старте настройки "Списка работ" пользователь-"Владелец" видит в области дефолтного справочника наименования работ
8. Пользователи могут добавлять новые строки в sys_work_list
1. Пользователь-"Чтение" может:
    1. просматривать список работ шахматки.
        1. все элементы управления (кнопки, чекбоксы, пр.) для него залочены.
    2. просматривать пользовательский список работ владельца шахматки:
        1. все элементы управления (кнопки, чекбоксы, пр.) для него залочены;
    3. скопировать к себе в шахматки список работ из чужой шахматки, к которой есть доступ. Пользовательский список в общем считаем системным, сквозным.
2. Пользователь-"Владелец" и пользователь-"Редактор" могут совершать эквивалентные действия по отношению к списку работ шахматки.
3. Пользователь-"Редактор" видит при настройке чужой шахматки чужой пользовательский список (список владельца).
4. Каждый пользователь может управлять своим пользовательским списком только при работе в своих шахматках.
5. Пользователь-"Владелец" и пользователь-"Редактор" могут:
    1. просматривать **список работ шахматки**:
        1. список работ шахматки поддерживает иерархическую структуру - пока доступен только один уровень вложенности папок (ранее это был "вид работ"; "этапов" больше нет).
    2. просматривать **пользовательский список работ** владельца шахматки:
        1. пользовательский список работ является плоским списком без иерархии.            
    3. выбирать одну или несколько наименований работ в пользовательском списке работ для массового добавления в список шахматки;
        1. после успешного переноса наименования работы из пользовательского списка работ в Список работ шахматки:
                1. перемещенное наименование работы попадает в корень струтуры "Список работ шахматки";
                2. при переносе работы она перестает отображаться в старой области и начинает отображаться в новой;
                3. старые галки чекбоксов в списке работ шахматки остаются, какими были;
                4. только что добавленным в шахматку работам проставляются незаполненные чекбоксы.
    4. выбирать одну или несколько наименований работ в списке работ шахматки (для удаления, для перемещения):
        1. при удалении: если наименование работ используется в шахматке (есть связанные с ним работы), возникает модальное окно "Внимание! Все равно удалить?". При согласии:
            1. Из таблицы work соответствующие наименования работ удаляются.
            2. Из таблицы task соответствующие работы удаляются.
            3. Работа по-настоящему (из таблицы sys_work_list) удаляться не умеет - sys_work_list хранит их все! Кривые, косые, с ошибками. Только дублей там быть не может, забегая вперед.
            4. Если папка "Вид работ" в списке работ шахматки:
                1. пустая, то по нажатии на кнопку "Удалить" она удаляется;
                2. имеет внутри себя хотя бы одно наименование работ, то при нажатии на кнопку "Удалить" удаляется содержимое папки.
            5. после успешного переноса наименования работы из шахматки в пользовательский список работ (aka "Удаление"):
                1. при переносе работы она перестает отображаться в старой области и начинает отображаться в новой;
                2. старые галки чекбоксов в пользовательском списке остаются, какими были;
                3. только что удаленным из шахматки работам проставляются незаполненные чекбоксы.
        2. при перемещении: переносить наименования работ в списке шахматки между разными уровнями вложенности:
            1. из произвольной комбинации расположений в группу работ на выбор (в папку);
            2. из произвольной комбинации расположений в корень.
            3. в частности, одна работу пользователь может перенести:
                1. из одной группы работ в другую;
                2. из корня в группу работ;
                3. из группы работ в корень.
        3. Если выбраны все наименования в списке работ шахматки, относящиеся к одному виду работ (к одной "папке") - проставляется чекбокс у папки;
        4. Если выбран хотя бы один элемента внутри папки, у папки проставляется состояние чекбокса "-";
        5. Если не выбрано ни одного элемента внутри папки, чекбокс у папки не проставлен.
        6. Если выбирана группа работ (папка):
            1. проставляются чекбоксы всем наименованиям работ внутри папки.
        7. Если снимается выделение с группы работ (папки):
            1. снимаются чекбоксы со всех наименований работ внутри папки.
    5. если в списке работ шахматки выбрано несоколько чекбоксов с работами или видами работ, это никак не влияет на процессы:
        1. при работе с кнопкой "Создать" ("Работу", "Вид работ");
        2. при работе с кнопкой "Список" ("Клонирование списка работ из другой шахматки", "Экспортировать в файл (xlsx)", "Импортировать из файла", "Очистить список")
    6. система никак не препятствует сводобному выбору работ одновременно в двух частях экрана - это разные списки;
    7. создавать новую работу непосредственно в списке шахматки:
        1. имя новой работы уникально для списка работ пользователя (и, соответственно, его подмножества - списка работ шахматки).
    8. создавать новую пустую группу работ (папку) в списке работ шахматки:
        1. имя новой группы работ уникально для списка работ шахматки.
    9. Раскрытая папка визуально отличается от свернутой.
    10. Пользователи ("Владелец" и "Редактор") могут осуществлять быстрый поиск/фильтрацию по работам:
        1. в списке пользователя по таблице sys_work_list
        2. в списке шахматки по таблице work
        3. поиск начиначется после ввода 1 символа
    9. Копировать список работ если у него есть хоть какой-то доступ к шахматке. Берутся работы справа. Левая часть у всех общая по системе
6. В ряде случаев возникают нотификации:
    1. когда для пользователя залочены кнопки ("Чтение"), нажание на любую из них генерирует обратную связь;
    2. при нажатии на кнопку "Удалить", если не выбрана ни одна работа, ошибка;
    3. при нажатии на кнопку "Переместить", если не выбрана ни одна работа, ошибка.
7. Если выбрано наименований работ больше, чем показывается из-за поиска, с специальной строке надо рабочей областью число строк с проставленными чекбоксами должно быть отражено.
8. Система позволяет добавить новую работу из контекстного меню в левой панели интерфейса при работе непосредственно с шахматкой.
9. Система позволяет быстро добавить в шахматку набор работ по нажанию на кнопку "Список" через следующие действия:
    1. "Клонировать из другой шахматки" - все наименования работ, все группы работ и их взаимосвязи копируются из другой шахматки (work, work_group), меняетя только project_id;
    2. ~~"Экспортировать в файл" - пока экспортируем только плоский список - перечень наименований работ в алфавитном порядке~~
    3. ~~"Импортировать из файла"- пока импортируем только плоский список работ~~ 
    4. "Очистить список" - удалить из списка работ шахматки все наименования работ и все виды работ.

### Функциональные требования на потом

1. Пользователь может редактировать наименования работ (внутри справочника работ шахматки)
2. У пользователя не может быть 0 объектов (шахматок):
    - пользователь на старте работы всегда получает демо-проект;
    - пользователь может создавать новые объекты;
    - пользователь может удалять свои объекты, если их больше 1 (корзинка?);
    - пользователь не может удалить последний объект (шахматку).
3. Прилипание кнопок управления к верхней части интерфейса при прокрутке списка работ вниз
4. Драг-н-дроп для настройки списка работ шахматки.
5. Импорт и экспорт и файлов.

### Предложения по контракту на импорт и экспорт файлов

Текстовый файл структуры:

```
  Вен­ти­ля­ция
По­жар­ные шка­фы /Ру­ка­ва внут­ри­квар­ти­но­го по­жа­ро­ту­ше­ния
Ре­шет­ки на кла­па­на ДУ/ Вен­ти­ля­ци­он­ные ре­шет­ки

    Бла­го­устрой­ство
  Бла­го­устрой­ство
Мон­таж ука­за­те­ля но­ме­ра дома
Уста­нов­ка бал­кон­но­го бло­ка
  Ра­бо­ты на сти­ло­ба­те
Мон­таж тро­туар­ной плит­ки / на ре­зи­но­вом ков­ри­ке
```

Пока больше одного уровня вложенности пока быть не может (как в примере с благоустройством). Поэтому текст выше должен вернуть три группы - 'Вентиляция', 'Благоустройство', 'Работы на стилобате'.

Если передавать древовидную структуру через скобки или другие служебные символы, надо продумывать экранирование этих символов в названиях работ.

Чаще всего, пользователи будут закидывать в систему файлы следующей структуры:

```
По­жар­ные шка­фы /Ру­ка­ва внут­ри­квар­ти­но­го по­жа­ро­ту­ше­ния
Ре­шет­ки на кла­па­на ДУ/ Вен­ти­ля­ци­он­ные ре­шет­ки
Бла­го­устрой­ство
Бла­го­устрой­ство
Мон­таж ука­за­те­ля но­ме­ра дома
Уста­нов­ка бал­кон­но­го бло­ка
Ра­бо­ты на сти­ло­ба­те
Мон­таж тро­туар­ной плит­ки / на ре­зи­но­вом ков­ри­ке
```

Форматы типа json как раз не бьются с отсылкой пользователем такого примитивного файла.

Для каждого из терминальных пунктов система производит поиск работ в **Системный список работ**. Потом выстраивает иерархическую структуру, если она есть.

### Use-cases

1. 
2. 
