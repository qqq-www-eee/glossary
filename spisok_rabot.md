### Используемые понятия

1. **Наименование работы** - обозначение некоторой строительной работы.
2. **Вид работ** (группа работ) - наименования работ, объединенные пользователем по какому-то принципу в группу. Отображается в UI как папка. Пока поддерживается только один уровень вложенности (по бизнесу: "Вид работ").
3. **Работа** - проведение конкретного наименования работ (work) в определенном помещении (room_group + storey).  
4. "**Список работ**" - раздел web- и мобильного приложений, отвечающий за настройку переченя работ в шахматке.
5. **Дефолтный список работ** - неизменяемый стартовый шаблон ([данные тут](https://docs.google.com/spreadsheets/d/1KBcwx9LyvH2fK0nzmJoen7atJCyp81WO-frnL3uYpXg/edit#gid=732289179)), из которого пользователь выбирает наименования работ для своей шахматки.
6. **Список работ шахматки** - перечень наименований работ, выбранные для данного объекта (шахматки).  

### Макеты

1. [Стартовый экран - список работ шахматки не настроен](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a3db0baa7996b68f10):
    - слева - **область дефолтных работ**;
    - справа - **область работ шахматки**.
2. [Список работ шахматки настроен](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a7f602847abe046714).

### Предложения по БД

1. Таблицы work и work_group, содержащие информацию о **списке работ шахматки**, оставить без изменений.  
2. Создать новую таблицу (напр., work_list_templates или default_work_list) под **дефолтный список работ**. Можно захардкодить, но есть подозрение, что со временем шаблонов может стать больше одного.  

### Функциональные требования

1. Пользователь зашел в шахматку: 
    1. если в списке работ шахматки нет ни одной работы (на старте работы либо в случае полного их удаления), система показывает в рабочей области шахматки заглушку с предложением настроить/создать список работ;
2. Находясь в шахматке: пользователь может перейти в раздел "**Список работ**":
    1. через [выпадающее меню кнопки "Настройка"](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63189f6251750b4bab2f76ec):
    2. через [контекстное меню левой панели](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a8ac1563680c3921f5) web-интерфейса по кнопке "Редактировать":
        1. В данном контекстном меню пользователь также может добавить новую работу напрямую, вызвав [модальное окно](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a1fd7ca66966563bc5) как при создании из раздела "Список работ".
2. Находясь в разделе "**Список работ**":
    2. если в списке работ шахматки нет ни одной работы, пользователь в разделе "**Список работ**" видит в области системных работ перечень наименований всех работ (sys_work_list, [сам список тут](/Дефолтные-работы.pdf)), а в области работ шахматки - заглушку.

 ~~3. Пользователи могут добавлять новые строки в список работ шахматки (work):~~
        ~~2. через кнопку "Создать"->"Работу" в разделе "Список работ".~~
2. Пользователи могут добавлять новые строки в системный список работ (sys_work_list), только через заведение их в список работ шахматки (work) (в sys_work_list попадает автоматически);

4. Пользователь-"Чтение" может:
    1. просматривать список работ шахматки.
        1. все элементы управления (кнопки, чекбоксы, инпуты, пр.) для него залочены.
    2. просматривать системный список работ:
        1. все элементы управления (кнопки, чекбоксы, инпуты, пр.) для него залочены;
    3. скопировать к себе в шахматку список работ из чужой шахматки, к которой у него есть доступ.
5. Пользователь-"Владелец" и пользователь-"Редактор" могут совершать эквивалентные действия по отношению к списку работ шахматки.
6. Пользователь-"Владелец" и пользователь-"Редактор" могут:
    1. просматривать **список работ шахматки**:
        1. список работ шахматки поддерживает иерархическую структуру - пока доступен только один уровень вложенности папок (ранее это был "вид работ"; "этапов" больше нет).
    2. просматривать **системный список работ**:
        1. системный список работ является плоским списком без иерархии.            
    3. выбирать одну или несколько наименований работ в системном списке работ для массового добавления в список шахматки;
        1. после успешного переноса наименования работы из системного списка работ в Список работ шахматки:
            1. перемещенное наименование работы попадает в корень струтуры "Список работ шахматки";
            2. при переносе работы она перестает отображаться в старой области и начинает отображаться в новой;
            3. старые галки чекбоксов в списке работ шахматки остаются, какими были;
            4. только что добавленным в шахматку работам проставляются незаполненные чекбоксы.
    4. выбирать одну или несколько наименований работ в списке работ шахматки (для удаления, для перемещения):
        1. при удалении: если наименование работ используется в шахматке (есть связанные с ним работы), возникает модальное окно "Внимание! Все равно удалить?". При согласии:
            1. Из таблицы work соответствующие наименования работ удаляются.
            2. Из таблицы task соответствующие работы удаляются.
            3. Работа по-настоящему (из таблицы sys_work_list) удаляться не умеет - sys_work_list хранит их все! Кривые, косые, с ошибками. Только дублей там быть не может, забегая вперед.
            4. Если папка "Вид работ" в списке работ шахматки:
                1. пустая, то по нажатии на кнопку "Удалить" она удаляется;
                2. имеет внутри себя хотя бы одно наименование работ, то при нажатии на кнопку "Удалить" удаляется содержимое папки.
            5. после успешного переноса наименования работы из шахматки в системный список работ (aka "Удаление"):
                1. при переносе работы она перестает отображаться в старой области и начинает отображаться в новой;
                2. старые галки чекбоксов в системном списке остаются, какими были;
                3. только что удаленным из шахматки работам проставляются незаполненные чекбоксы.
        2. при перемещении: переносить наименования работ в списке шахматки между разными уровнями вложенности:
            1. из произвольной комбинации расположений в группу работ на выбор (в папку);
            2. из произвольной комбинации расположений в корень.
            3. в частности, одна работу пользователь может перенести:
                1. из одной группы работ в другую;
                2. из корня в группу работ;
                3. из группы работ в корень.
        3. Если выбраны все наименования в списке работ шахматки, относящиеся к одному виду работ (к одной "папке") - проставляется чекбокс у папки;
        4. Если выбран хотя бы один элемента внутри папки, у папки проставляется состояние чекбокса "-";
        5. Если не выбрано ни одного элемента внутри папки, чекбокс у папки не проставлен.
        6. Если выбирана группа работ (папка):
            1. проставляются чекбоксы всем наименованиям работ внутри папки.
        7. Если снимается выделение с группы работ (папки):
            1. снимаются чекбоксы со всех наименований работ внутри папки.
    5. если в списке работ шахматки выбрано несоколько чекбоксов с работами или видами работ, это никак не влияет на процессы:
        1. при работе с кнопкой "Создать" ("Работу", "Вид работ");
        2. при работе с кнопкой "Список" ("Клонирование списка работ из другой шахматки", "Экспортировать в файл (xlsx)", "Импортировать из файла", "Очистить список")
    6. система никак не препятствует сводобному выбору работ одновременно в двух частях экрана - это разные списки;
    7. создавать новую работу непосредственно в списке шахматки:
        1. имя новой работы уникально для системного списка работ (и, соответственно, его подмножества - списка работ шахматки).
        2. если имя новой работы совпало с существующим в системном списке
            1. если работа есть в списке шахматки, ошибка, нельзя добавить;
            2. если работы нет в списке шахматки, то система ничего не делает (делает вид, что добавила, хотя работа уже есть в системном списке). 
    8. создавать новую пустую группу работ (папку) в списке работ шахматки:
        1. имя новой группы работ уникально для списка работ шахматки.
        2. если имя новой группы работ не уникально, ошибка, нельзя добавить;
    9. Раскрытая папка визуально отличается от свернутой.
    10. Пользователи ("Владелец" и "Редактор") могут осуществлять быстрый поиск/фильтрацию по работам:
        1. в списке пользователя по таблице sys_work_list
        2. в списке шахматки по таблице work
        3. поиск начиначется после ввода 1 символа
    9. Копировать список работ если у него есть хоть какой-то доступ к шахматке. Берутся работы справа. Левая часть у всех общая по системе
7. В ряде случаев возникают нотификации:
    1. когда для пользователя залочены кнопки ("Чтение"), нажание на любую из них генерирует обратную связь;
    2. при нажатии на кнопку "Удалить", если не выбрана ни одна работа, ошибка;
    3. при нажатии на кнопку "Переместить", если не выбрана ни одна работа, ошибка.
8. Если выбрано наименований работ больше, чем показывается из-за поиска, с специальной строке надо рабочей областью число строк с проставленными чекбоксами должно быть отражено.
9. Система позволяет добавить новую работу из контекстного меню в левой панели интерфейса при работе непосредственно с шахматкой.
10. Система позволяет перейти в раздел "**Список работ**" из контекстного меню в левой панели интерфейса при работе непосредственно с шахматкой.
11. Система позволяет быстро добавить в шахматку набор работ по нажанию на кнопку "Список" через следующие действия:
    1. "Клонировать из другой шахматки" - все наименования работ, все группы работ и их взаимосвязи копируются из другой шахматки (work, work_group), меняетя только project_id;
    2. ~~"Экспортировать в файл" - пока экспортируем только плоский список - перечень наименований работ в алфавитном порядке~~
    3. ~~"Импортировать из файла"- пока импортируем только плоский список работ~~ 
    4. "Очистить список" - удалить из списка работ шахматки все наименования работ и все виды работ.
1. Работа (task) привязывается к наименованиям работ (work):
    1. Удаление строки из work приводет к удалению соответствующих строк из task.

### Функциональные требования на потом

1. Прилипание кнопок управления к верхней части интерфейса при прокрутке списка работ вниз
2. Драг-н-дроп для настройки списка работ шахматки.
3. Импорт и экспорт и файлов - предлагается отложить на отдельную проработку по всем импортам и экспортам.

### Комментарии и предложения по контракту на импорт и экспорт файлов

Текстовый файл структуры:

```
  Вен­ти­ля­ция
По­жар­ные шка­фы /Ру­ка­ва внут­ри­квар­ти­но­го по­жа­ро­ту­ше­ния
Ре­шет­ки на кла­па­на ДУ/ Вен­ти­ля­ци­он­ные ре­шет­ки

    Бла­го­устрой­ство
  Бла­го­устрой­ство
Мон­таж ука­за­те­ля но­ме­ра дома
Уста­нов­ка бал­кон­но­го бло­ка
  Ра­бо­ты на сти­ло­ба­те
Мон­таж тро­туар­ной плит­ки / на ре­зи­но­вом ков­ри­ке
```

Пока больше одного уровня вложенности пока быть не может (как в примере с благоустройством). Поэтому текст выше должен вернуть три группы - 'Вентиляция', 'Благоустройство', 'Работы на стилобате'.

Если передавать древовидную структуру через скобки или другие служебные символы, надо продумывать экранирование этих символов в названиях работ.

Чаще всего, пользователи будут закидывать в систему файлы следующей структуры:

```
По­жар­ные шка­фы /Ру­ка­ва внут­ри­квар­ти­но­го по­жа­ро­ту­ше­ния
Ре­шет­ки на кла­па­на ДУ/ Вен­ти­ля­ци­он­ные ре­шет­ки
Бла­го­устрой­ство
Бла­го­устрой­ство
Мон­таж ука­за­те­ля но­ме­ра дома
Уста­нов­ка бал­кон­но­го бло­ка
Ра­бо­ты на сти­ло­ба­те
Мон­таж тро­туар­ной плит­ки / на ре­зи­но­вом ков­ри­ке
```

Форматы типа json как раз не бьются с отсылкой пользователем такого примитивного файла.

Для каждого из терминальных пунктов система производит поиск работ в **Системный список работ**. Потом выстраивает иерархическую структуру, если она есть.

### Use-cases

1. Пользователь ("Владелец") настраивает новую шахматку.
2. Пользователь ("Редактор") редактирует список работ в чужой шахматке.
3. Пользователь ("Владелец") просматирвает изменения, внесенные редакторами в его шахматку.


---


~~5. **Пользовательский список работ** - перечень наименований работ, доступных данному пользователю. Из них пользователь выбирает наименования работ для своей шахматки.~~  
~~7. **Дефолтный список работ** - универсальный стартовый шаблон, порождающий пользовательский список работ на старте взаимодействия пользователя с системой.~~
~~5. Пользователь-"Редактор" видит при настройке чужой шахматки чужой п-й список (список владельца).~~
~~5. Каждый пользователь может управлять своим п-м списком только при работе в своих шахматках.~~

1. У пользователя не может быть 0 объектов (шахматок):
    - пользователь на старте работы всегда получает демо-проект;
    - пользователь может создавать новые объекты;
    - пользователь может удалять свои объекты, если их больше 1 (корзинка?);
    - пользователь не может удалить последний объект (шахматку).
