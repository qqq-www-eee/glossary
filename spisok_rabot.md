### Краткое описание

1. Настройка списка работ ведется в двух областях интерфейса:
    1. Левая отображает готовый системный шаблон на основе [этих данных](https://docs.google.com/spreadsheets/d/1KBcwx9LyvH2fK0nzmJoen7atJCyp81WO-frnL3uYpXg/edit#gid=732289179). Пользователь не может изменять шаблон. Шаблон не имеет иерархической структуры (плоский список);
    2. Правая область отвечает за настройку текущей пользовательской шахматки. Пользователь может изменять шаблон (создавать, удалаять, перемещать), но не может редактировать конкретные наименования работ. Список работ шахматки поддерживает иерархическую структуру (вложенность папок не более 1 уровня).
2. В левой части экрана пользователь может:
    1. добавлять одну/несколько выбранных работ из шаблона в список шахматки. Наименования работ перестанут отображаться в левой части ui и начнут отображаться в корне в правой части ui.
3. В правой части экрана пользователь может:
    1. создавать новые наименования работ и новые Виды работ (пустые папки). Если название создаваемой работы уже есть в дефолтном шаблоне, система не ругается - наименование работы создается в правой части ui; при этом в левой части ui соответствующее наименование работы перестает отображаться;
    2. перемещать одну/несколько выбранных наименований работ из различных папок в некоторую существующую папку. Корень отображается в списке папок как пункт "Поместить вне видов работ";
    3. удалять выбранные наименования работ и выбранные виды работ (папки). Наименования работ перестанут отображаться в правой части ui и начнут отображаться в левой, если они есть в дефолтном шаблоне (если же удаляемая работа отсутствует в шаблоне и была создана пользователем, она просто удаляется).
    Если папка "Вид работ" в списке работ шахматки пустая, по нажатии на кнопку "Удалить" она удаляется; если же она имеет внутри себя хотя бы одно наименование работ, при нажатии на кнопку "Удалить" удаляется только содержимое папки.
    5. работать со списком работ:
        1. Клонировать список работ из другой шахматки;
        2. Очистить список.
        3. Экспортировать список работ;
        4. Импортировать список работ - чаще всего импортируемый список будет плоским. В любом случае, нужен контракт.
4. Наименования работ в шаблоне уникальны. Наименования работ в списке шахматки уникальны (сквозным образом, то есть в двух разных папках не могут встретиться одинаковые наименования работ). Виды работ в списке шахматки уникальны. Работа и вид могут иметь одинаковое название. 
5. Нотификации показываются, когда
    1. невозможно переместить или удалить работы, так как ни одна работа не выбрана;
    2. работы были успешно удалены.
7. Некоторые модальные окна:
    1. "Клонирование списка работ из другой шахматки" - при нажатии на "Список" -> "Клонировать из другой шахматки";
    2. "Требуется подтверждение" - при нажатии на кнопку "Список" -> "Клонировать из другой шахматки" (после модального окна 1) / "Импортировать из файла" (после окна выбора файла) / "Очистить список";
    6. "Внимание! Все равно удалить?" - при нажатии на "Удалить", только если только данные работы задействованы в текущей шахматке.
8. Сортировка работ по алфавиту в левой и правой частях; вверху все папки, внизу все работы в корне списка.
9. Пользователь с правами "Чтение" может просматривать список работ, но не может ничего в нем редактировать; может клонировать список работ к себе в шахматки. Пользователь с правами "Редактирование" может все то же, что владелец, в т. ч. числе редактировать список работ и клонировать его к себе в шахматки.

Формат файла для экспорт:
xlsx, две колонки

| Наименование работы                       | Вид работ, к которому он относится |
| ----------------------------------------- | ---------------------------------- |
| Грунтование бетонных поверхностей стен    | Вертикальные работы                |
| Обработка стен гидрофобизирующим составом |                                    |
| Штукатурка стен                           | Вертикальные работы                |

### Макеты

1. [Стартовый экран - список работ шахматки не настроен](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a3db0baa7996b68f10):
    - слева - **область дефолтных работ**;
    - справа - **область работ шахматки**.
2. [Список работ шахматки настроен](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a7f602847abe046714).

### Используемые понятия

1. **Наименование работы** - обозначение некоторой строительной работы (work).
2. **Вид работ** - группа наименованй работ, объединенных пользователем по какому-то принципу. Отображается в UI как папка. Поддерживается только один уровень вложенности (по бизнесу "Вид работ")(work_group).
3. **Работа** - проведение конкретного наименования работ (work) в определенном помещении (room_group + storey) (task).  
4. "**Список работ**" - раздел web- и мобильного приложений, отвечающий за настройку переченя работ в шахматке.
5. **Дефолтный список работ** - неизменяемый стартовый шаблон ([данные тут](https://docs.google.com/spreadsheets/d/1KBcwx9LyvH2fK0nzmJoen7atJCyp81WO-frnL3uYpXg/edit#gid=732289179)), из которого пользователь выбирает наименования работ для своей шахматки (work_template).
6. **Список работ шахматки** - перечень наименований работ, выбранных для данного объекта (шахматки)(?).  

### Предложения по БД

1. Использовать существующие таблицы **work**, **work_group**, **work_template**.  

### Функциональные требования

1. Пользователь перешел в шахматку: 
    1. если в списке работ шахматки нет ни одной работы (на старте работы либо в случае полного их удаления), система показывает в рабочей области шахматки [заглушку](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63189f6668c09348e504689a) с предложением настроить/создать список работ;
2. Находясь в шахматке: пользователь может перейти в раздел "Список работ":
    1. через [выпадающее меню кнопки "Настройка"](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63189f6251750b4bab2f76ec):
    2. через [контекстное меню левой панели web-интерфейса](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a8ac1563680c3921f5), по кнопке "Редактировать":
        1. в данном контекстном меню пользователь может напрямую добавить новую работу, вызвав [модальное окно](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a1fd7ca66966563bc5) как при создании из раздела "Список работ" (забегая вперед, работа падает в корень структуры списка работ шахматки).
    3. Через кнопку в [заглушке](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63189f6668c09348e504689a), если список работ шахматки пустой.
3. При нахождении пользователя в разделе "Список работ":
    1. если в списке работ шахматки нет ни одной работы, пользователь видит в области дефолтных работ перечень наименований всех работ базового шаблона (work_template, [данные тут](https://docs.google.com/spreadsheets/d/1KBcwx9LyvH2fK0nzmJoen7atJCyp81WO-frnL3uYpXg/edit#gid=732289179)), а в области работ шахматки - заглушку.
    2. если наименование работы из списка дефолтных есть в области работ шахматки справа, такое же наименование работ НЕ отображается в области дефолтных работ слева (актуально при добавлении наименований работ).
    3. если наименования работы из списка дефолтных нет в области работ шахматки справа, это наименование работ отображается в области дефолтных работ слева (актуально при удалении наименований работ).
    4. Пользователи всегда видят в "Дефолтном списке работ" и в "Списке работ шахматки" то состояние, какое видит владелец шахматки:
        1. при этом для "Владельца" и "Редактора" все контролы доступны для работы;
        2. при этом для "Чтеца" контролы, кроме кнопки "Отмена", доступны только для просмотра. "Отмена" доступна для взаимодействия.
4. Пользователь-"Чтение" может:
    1. просматривать раздел "Список работ" шахматки:
        1. Дефолтный список работ и Список работ шахматки:
            1. все элементы управления (кнопки, чекбоксы, инпуты) для него залочены.
        2. Верхняя панель:
            1. Кнопка "Сохранить" залочена;
            2. Кнопка "Отмена" доступна.
        3. Когда пользователь взаимодействует с залоченными контролами, ему показывается [алерт](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/631a3ccb2fa6ea677c14d5a4).
    2. клонировать чужой список работ шахматки в свои шахматки.
5. Пользователь-"Владелец" и пользователь-"Редактор" могут совершать эквивалентные действия по отношению к списку работ шахматки.
6. Пользователь-"Владелец" и пользователь-"Редактор" могут:
    1. просматривать список работ шахматки:
        1. список работ шахматки поддерживает иерархическую структуру - сейчас доступен только один уровень вложенности папок (ранее это был "вид работ"; "этапов" больше нет).
    2. просматривать дефолтный список работ:
        1. системный список работ является плоским списком без иерархии.            
    3. выбирать одну или несколько наименований работ в дефолтном списке работ для (массового) добавления в список шахматки; после успешного добавления:
        1. перемещенные наименования работ попадают в корень струтуры "Список работ шахматки";
        2. при переносе работы она перестает отображаться в старой области и начинает отображаться в новой (хотя из таблицы work_template запись не удаляется);
        3. старые галки чекбоксов в списке работ шахматки остаются, какими были;
        4. только что добавленным в шахматку работам проставляются незаполненные чекбоксы.
    4. выбирать одну или несколько наименований работ в списке работ шахматки (для удаления, для перемещения):
        1. Удаление:
            1. если к наименованию работ в шахматке привязаны работы (таски, задачи): перед удалением показать [модальное окно](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a1fd7ca66966563bc5) "Внимание! Все равно удалить?".
            2. если к наименованию работ не привязаны работы (таски, задачи) ИЛИ при прямом согласии пользователя в модальном окне:
                1. Для наименований работ, добавленных из дефолтного списка (представленных в таблице work_template):
                    1. Из таблицы work соответствующие наименования работ удаляются + из таблицы task соответствующие работы каскадом также удаляются.
                    2. На front-end перестает выполняться условие на присутствие данных дефолтных работ в списке работ шахматки (справа), поэтому в области дефолтных работ (слева) они начинают отображаться:
                        1. старые галки чекбоксов в дефолтном списке остаются, какими были;
                        2. только что удаленным из шахматки работам проставляются незаполненные чекбоксы.
                2. Для наименований работ, введенных пользователем вручную:
                    1. Из таблицы work соответствующие наименования работ удаляются + из таблицы task соответствующие работы каскадом также удаляются.
                3. Из дефолтного списка работ (таблицы work_template) наименование работы никогда не удаляется.
            3. Если папка "Вид работ" в списке работ шахматки:
                1. пустая, то по нажатии на кнопку "Удалить" она удаляется;
                2. имеет внутри себя хотя бы одно наименование работ, то при нажатии на кнопку "Удалить" удаляется содержимое папки.
        2. Перемещение:
            1. можно переносить наименования работ в списке шахматки из произвольной комбинации расположений (с разных уровней вложенности):
                1. в группу работ на выбор (в папку);
                2. в корень:
                    1. В модальном окне помимо "Видов работ" в дропдауне есть пункт "Переместить вне видов работ".
        3. Если выбраны все наименования, относящиеся к одному виду работ (к одной "папке") - проставляется чекбокс у папки;
        4. Если внутри папки хотя бы один элемента выбран и хотя бы один элемент не выбран, у папки проставляется состояние чекбокса "-";
        5. Если не выбрано ни одного элемента внутри папки, у папки пустой чекбокс.
        6. Если выбирается группа работ (папка):
            1. проставляются чекбоксы всем наименованиям работ внутри папки.
        7. Если снимается выделение с группы работ (папки):
            1. снимаются чекбоксы со всех наименований работ внутри папки.
    5. выбранные чекбоксы работ или видов работ никак не влияют на процессы работы:
        1. кнопки "Создать" ("Работу", "Вид работ");
        2. кнопки "Список" ("Клонирование", "Экспорт", "Импорт", "Очистить").
    6. создавать новую работу в списке шахматки по кнопке "Создать":
        1. имя новой работы [должно быть уникально](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a1fd7ca66966563bc5) для списка работ шахматки.
            1.Если наименования работы еще нет в списке шахматки (справа):
                1. добавить новое наименование работы в корень структуры "список работ шахматки";
                    1. чекбокс новой работы пустой;
                2. Если данное наименование работы было при этом представлено в дефолтном списке работ (слева):
                    1. на front-end работа должна перестать отображаться в дефолтном списке работ (слева) после добавления.
            2. если имя новой работы совпало существующим наименованием работы (справа):
                1. ошибка, нельзя добавить.
    7. создавать новую работу из [контекстного меню](https://app.zeplin.io/project/63189e67cde56b49dacec5e2/screen/63d101a8ac1563680c3921f5) в левой панели интерфейса при работе непосредственно с шахматкой;
    8. создавать новую пустую группу работ (папку) в списке работ шахматки по кнопке "Создать":
        1. имя новой группы работ уникально для списка работ шахматки.
        2. если имя новой группы работ не уникально, ошибка, нельзя добавить;
    9. "Работа" и "Вид работы" могут иметь одинаковые названия;
    10. Клик ЛКМ раскрывает и закрывает папку (вид работ):
        1. раскрытая и закрытая (свернутая) папки визуально отличаются друг от друга.
    11. Пользователи ("Владелец" и "Редактор") могут осуществлять быстрый поиск/фильтрацию по работам:
        1. в дефолтном списке работ по таблице work_template;
        2. в списке работ шахматки по таблице work;
        3. поиск начиначется после ввода в инпут 1 символа;
        4. после стирания поискового запроса древовидная структура списка работ шахматки должна восстанавливаться к состоянию, которым обладала до поиска.
        5. если выбрано наименований работ больше, чем показывается из-за поиска, в строке над DOM-областью должно отражаться число строк с проставленными чекбоксами.
    12. клонировать чужой список работ шахматки в свои шахматки.
7. Нотификации показываются пользователю:
    1. при нажатии на кнопку "Удалить", если не выбрана ни одна работа (ошибка);
    2. при нажатии на кнопку "Переместить", если не выбрана ни одна работа (ошибка).
    3. при успешном удалении работы/работ.
8. Система позволяет быстро добавить в шахматку набор работ через кнопку "Список":
    1. "Клонировать из другой шахматки" - все наименования работ, все группы работ и их взаимосвязи (work, work_group) копируются из другой шахматки, к которой у пользователя есть доступ:
        1. Конкретная шахматка выбирается через модальное окно:
            1. Можно выбрать свои шахматки;
            2. Можно выбрать шахматки, к которым есть доступ ("Чтение" ок);
            3. Визуально в дропдауне необходимо эти группы отделять;
            4. Порядо следования дропдауне совпадает с порядком следования объектов в главном меню.
        1. Клонировать можно как из своих, так и из чужих шахматок. Даже если пользователь там с правами только на "Чтение".
    2. "Экспортировать в файл" - после шаблонов
    3. "Импортировать из файла"- после шаблонов 
    4. "Очистить список" - удалить из списка работ шахматки все наименования работ и все виды работ.
9. При прокрутке длинного списка работ вниз кнопки управления списками должны прилипать к верхней части интерфейса.
10. Сортировка работ по алфавиту в левой и правой частях; вверху все папки, внизу все работы в корне списка.
11. Модальные окна:
    1. "Клонирование списка работ из другой шахматки" - показывается при нажатии на кнопку "Список" -> "Клонировать из другой шахматки";
    2. "Требуется подтверждение" - при нажатии на кнопку "Список" -> "Клонировать из другой шахматки" (после модального окна 1) / "Импортировать из файла" (после окна выбора файла) / "Очистить список";
    3. "Работа" - при нажатии на "Создать" -> "Работу";
    4. "Вид работ" - при нажатии на "Список" -> "Вид работ";
    5. "Переместить" - при нажатии на "Переместить";
    6. "Внимание! Все равно удалить?" - при нажатии на "Удалить", если только данные работы задействованы в текущей шахматке.

### Backlog

1. Поддержка пользовательских шаблонов.
2. ДнД для настройки списка работ шахматки.

### Use-cases

1. Пользователь ("Владелец") настраивает новую шахматку.
2. Пользователь ("Редактор") редактирует список работ в чужой шахматке.
3. Пользователь ("Владелец") просматирвает изменения, внесенные редакторами в его шахматку.
4. Пользователь удаляет работу, которая не была задействована в шахматке (нет модалки).
5. Пользователь удаляет работу, которая была задействована в данной шахматке (показывается модалка).
5. Пользователь А (достаточно "чтеца") просматривает список работ и клонирует список работ к себе в шахматку; пользователь Б удаляет работу в исходной шахматке; пользователь А сохраняет настройки списка работ. В новой шахматке список работ должен будет содержать все те работы, которые в исходной шахматке теперь уже удалены.  
