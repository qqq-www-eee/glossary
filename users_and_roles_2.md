### Введение

В системе представлены сущности **Пользователь** и **Контакт**.
  - **Пользователь** соответствует человеку, который зарегистрировался в системе и использует продукт в работе.
  - **Контакт** не является зарегистрированным / авторизованным пользователем и представляет в системе человека, с которым определенный пользователь взаимодействует в реальной жизни (исполнителя, технадзора, др.).  

---

### Пользователь

1. Набор атрибутов **пользователя** ( * - обязательные):
   1. Номер телефона *
   2. ФИО (одним полем) *
   3. email
   4. Телеграм
   5. Должность
   6. ~~Фото (позже)~~

   + служебные: uuid, дата последнего входа в систему и др.

2. "Телефон" указывается **пользователем** при регистрации.

3. "ФИО" указывается пользователем по запросу системы ("Введите ваше имя") при регистрации после ввода корректного СМС-кода.

4. Пользователь может не указать "ФИО" при регистрации, тогда полю присваивается значение по умолчанию: "Пользователь Платформы".

6. Все атрибуты пользователя могут быть им изменены в разделе "Учетная запись" (кроме служебных полей).

7. Обязательные атрибуты пользователя (*) возможно изменить, но невозможно удалить или оставить пустыми.

8. Необязательные атрибуты пользователя возможно оставить или сделать пустыми.

9. Ограничения на поля сущности **"Пользователь"**:
   1. "Номер телефона" имеет формат 7********** 11 символов (вообще, телефоны бывают до 14 символов длиной, но с другими кодами; сейчас работаем только с международными кодами +7: РФ / Казахскими / Абхазия).
   2. Максимальная длина поля "ФИО" - 255 символов.
   3. "email" формата %@%.% , длина строки не более 255 символов.
   4. Длина строки "Телеграм" не менее 5 символов и не более 32 символов.
   5. Должность - одна из списка (можно через uuid или строку):

<br> 

| Должность          |
| ------------------ |
| Прораб             |
| Технадзор          |
| Мастер участка     |
| Инженер ПТО        |
| Начальник участка  |
| Сметчик            |
| Бригадир           |
| Рабочий            |

-
  6. ~~Фото - ссылка на файл, загруженный на сторонний S3-сервер. Имеет параметры:~~
      - ~~квадратный формфактор~~
      - ~~размер изображение 600*600px~~
      - ~~размер на диске - 300Кб~~
      - ~~формат jpeg.~~

  7. ~~Система дает пользователю возможность прикрепить к своему профилю изображение произвольного расширения, разрешения, размера и пр. в разделе "Учетная запись". Система самостоятельно центрирует, обрезает, сжимает фото и конвертирует его в нужный формат.~~

10. Система предоставляет каждому **пользователю** возможность управлять своим "Списком контактов" (по аналогии с "телефонной книгой") - создавать, редактировать, просмативать и удалять **контакты**.

11. Система предоставляет **пользователю** возможность добавлять **свои контакты** в списки "Исполнители" в шахматках.

12. Система предоставляет **пользователю** возможность добавлять **свои контакты** в списки "Технадзор" в шахматках.

13. **Пользователей нельзя добавлять в списки шахматок.**

14. Если человек пользуется несколькими номерами телефонов, для каждого из них в системе потребуется создать отдельный контакт.

15. Один и тот же человек как **контакт** может быть отражен в системе несколько раз - у разных **пользователей** (эквивалентно: номер телефона может встретиться в системе более одного раза).

16. Один и тот же человек как **контакт** записан у конкретного пользователя не более одного раза (эквивалентно: номер телефона **контакта** для конкретного **пользователя** уникален).

17. Поле "Телефон" может быть неуникально в таблице **пользователей** в БД!!!

---

### Контакт

1. Набор атрибутов **контакта** ( * - обязательные):
   1. Номер телефона *
   2. ФИО (одним полем) *
   3. Должность
   4. Комментарий  
   5. Владелец контакта (uuid) *
   6. Ссылка на пользователя с данным телефоном (uuid, если есть)
   7. ~~Идентификатор справочника 1С "Исполнитель"~~

   ~~+ служебные, uuid~~

2. При редактировании списка контактов пользователем вручную поля "Номер телефона" и "ФИО" нельзя оставить пустыми.

3. Контакт всегда относится к определенному пользователю. Принадлежность к пользователю невозможно изменить без удаления контакта.

4. Поля контакта 3, 4, 8, 9 могут быть пустыми.

5. Ограничения на поля для контактов соответствуют ограничениям на аналогичные поля для пользователей, а именно:
   - "Номер телефона" имеет формат 7********** (11 символов).
   - Максимальная длина строки "ФИО" - 255 символов.
   - "Должность" - одна из списка, как у пользователей.
   - "Комментарий" - ограничение 255 символов.

---

### Связь пользователя с контактами.

1. При создании контакта: если в системе найдет пользователь с таким номером телефона, система кладет ссылку на этого пользователя в новый контакт.

2. Если новый пользователь регистрируется сам (без инвайта), связь с контактами с таким же номером телефона устанавливать нельзя! Контакты могли устареть? ~~При самостоятельновй регистрации в системе нового пользователя и добавлении его данных в БД, система составляет список всех контактов остальных пользователей, для которых указан номер телефона, введенный только что зарегистрировавшимся пользователем. Однако, не вынув кишки из пользователей, невозможно установить идентичность сущности из справочников и из таблицы пользователей. Иначе бы просто проставили ссылку на данного нового зарегистрировавшегося пользователя всем контактам, обладающим таким же номером телефона~~

3. Если новый пользователь регистрируется через инвайт, то кладем ссылку на нового пользователя в контакт того, кто выслал инвайт, обладающий таким же номером телефона. А другим пользователям, выходит, класть нельзя! 

4. При выдаче доступов к шахматке: если пользователь уже существует в системе, его все равно никак не связать с списками контактов этого пользователя. 

5. Изменение атрибутов пользователя никак не отражается на контактах, имеющих, например, такой же номер телефона или не дай бог имеющих откуда-то ссылку на данного пользователя.

6. Номер телефона как у пользователя, так и у контакта всегда виден другим пользователям (кейс: карточка с контактами и именами и т. д.).

7. экспорт импорт

8. руками пользователя импортировать из другой шахматки

9. Ограничение на длину поля ФИО в контакте - 255 (отражаться в шахматке будут только 15 или по ширине, будет уточнено в отдельных требованиях)