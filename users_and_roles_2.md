## Требования к пользователям и контактам

### Введение

В системе представлены две схожие сущности:
  - **Пользователь** соответствует человеку, который зарегистрировался в системе и использует продукт в работе.
  - **Контакт** не является зарегистрированным / авторизованным пользователем и представляет в системе человека, с которым некий пользователь взаимодействует в реальной жизни (исполнитель, технадзор, др.).  

---

### Пользователь

1. Набор атрибутов **пользователя** ( * - обязательные):
   1. Номер телефона *
   2. ФИО (одним полем) *
   3. email
   4. Телеграм
   5. Должность
   6. Фото (функционал будет добавлен позже)
   7. Контрольное слово  
   '+ служебные: uuid, Логин, Дата последнего входа в систему, Дата создания, Дата последнего обновления и др. - not null. Статус тоже нужен, как минимум - active и deleted.

2. "Логин" в виде строки с номером телефона указывается пользователем при регистрации.

3. "Номер телефона" при регистрации заполняется системой автоматически - по умолчанию туда помещается значение из поля "Логин".

4. "ФИО" указывается пользователем при регистрации, по запросу системы ("Введите ваше имя"), после ввода корректного СМС-кода.

5. Пользователь может не указать "ФИО" при регистрации, тогда полю присваивается значение по умолчанию: "Пользователь Платформы".

6. При входе пользователя в систему, если текущая дата отстоит от даты регистрации аккаунта более, чем на две недели, система предлагает пользователю ввести контрольное слово.

7. Если контрольное слово было единожды введено, поле "Контрольное слово" считается для пользователя обязательным (его больше нельзя сделать пустым).

8. Атрибуты пользователя 1-7 могут быть им изменены в разделе "Учетная запись".

9. Обязательные атрибуты пользователя (*) возможно изменить, но невозможно удалить или оставить пустыми.

10. Необязательные атрибуты пользователя возможно сделать пустыми.

11. Ограничения на поля сущности **"Пользователь"**:
    1. "Номер телефона" имеет формат 7********** 11 символов (бывают до 14 символов длиной, но с другими кодами; сейчас поддерживаются только международный код +7: РФ / Казахстан / Абхазия).
    2. Максимальная длина поля "ФИО" - 255 символов.
    3. "email" формата %@%.% , длина строки не более 255 символов.
    4. Длина строки "Телеграм" ~~не менее 5 символов и~~ не более 32 символов.
    5. "Должность" - одна из списка (можно реализовать через uuid или строку):

<br> 

| Должность          |
| ------------------ |
| Прораб             |
| Технадзор          |
| Мастер участка     |
| Инженер ПТО        |
| Начальник участка  |
| Сметчик            |
| Бригадир           |
| Рабочий            |

-
  6. ~~"Фото" - ссылка на файл, загруженный на сторонний S3-сервер со свойствами:~~
       - ~~квадратный формфактор~~
       - ~~размер изображения 600*600px~~
       - ~~размер на диске 300Кб~~
       - ~~формат jpeg.~~
       - ~~Система дает пользователю возможность прикрепить к своему профилю изображение произвольного расширения, разрешения, размера и пр. в разделе "Учетная запись".~~
       - ~~Система самостоятельно центрирует, обрезает, сжимает фото, конвертирует его в нужный формат.~~
  7. Система предлагает на выбор два-три вопроса, ответом на один из которых будет контрольное слово.

12. Если пользователь авторизуется в системе по номеру телефона спустя продолжительное время отсутствия (180 дней), система запрашивает у пользователя контрольное слово. Это связано с тем, что у номер телефона может смениться владелец.

13. Если челоек не может ввести кодовое слово, то система предлагает пользователю завести новый аккаунт.

14. Каждое из полей 1-6 в таблице пользователей в БД может оказаться неуникальным, в том числе и поле "Телефон". 

15. Служебное поле "Логин" обязано быть уникальным.

16. Если пользователь для входа в систему использует номер, представленный в системе как "Логин", происходит авторизация, иначе происходит регистрация.

17. "Номер телефона" может отличаться от "Логина", только если пользователь сменил его в своих настройках.

18. **Пользователей нельзя добавлять в списки шахматок.**

19. Система предоставляет каждому **пользователю** возможность управлять своим "Списком контактов" (по аналогии с "телефонной книгой") - создавать, редактировать, просмативать и удалять **контакты**.

20. Система предоставляет **пользователю** возможность добавлять **свои контакты** в списки "Исполнители" в шахматках.

21. Система предоставляет **пользователю** возможность добавлять **свои контакты** в списки "Технадзор" в шахматках.

---

### Контакт

1. Набор атрибутов **контакта** ( * - обязательные):
   1. Номер телефона *
   2. ФИО (одним полем) *
   3. email
   4. Телеграм
   5. Должность
   6. Комментарий  
   7. Владелец контакта (uuid) *
   8. ~~Ссылка на пользователя с данным телефоном (uuid)~~
   9. ~~Идентификатор справочника 1С "Исполнитель"~~
   '+ служебные, uuid

2. Атрибуты 1-6 задаются пользователем.

3. Атрибуты 7-9 проставляются системой, если это возможно.

3. При редактировании списка контактов пользователем вручную поля "Номер телефона" и "ФИО" (атрибуты 1, 2) нельзя оставить пустыми.

4. Контакт всегда относится к определенному пользователю. Принадлежность к пользователю невозможно изменить без удаления контакта (атрибут 7).

5. Поля контакта 3-6, 8, 9 могут быть пустыми.

6. Ограничения на поля для контактов, редактируемые пользователем вручную, соответствуют ограничениям на аналогичные поля для пользователей, а именно:
   - "Номер телефона" имеет формат 7********** (11 символов).
   - Максимальная длина строки "ФИО" - 255 символов.
   - "email" формата %@%.% , длина строки не более 255 символов.
   - "Телеграм" ~~не менее 5 символов и~~ не более 32 символов.
   - "Должность" - одна из списка, как у пользователей.
   - "Комментарий" - ограничение 255 символов.

9. Если человек пользуется несколькими номерами телефонов, для каждого из них в системе потребуется создать отдельный контакт.

10. Один и тот же реальный человек как **контакт** может быть отражен в системе несколько раз - у разных пользователей (эквивалентно: номер телефона может встретиться в системе более одного раза).

11. Один и тот же реальный человек как **контакт** записан у конкретного пользователя не более одного раза (эквивалентно: номер телефона контакта для конкретного пользователя уникален).

---

### Связь пользователя с контактами.

1. Поддержка ссылок в **контакте** на **пользователя** системы, который в реальности является тем же человеком, не осуществляется.

2. Система предоставляет возможность пользователю удобно скопировать следующие атрибуты **контакта**, чтобы поделиться данной информацией через месседжеры: 
    - ФИО
    - телефон
    - телеграм
    - почта

~~2. При создании контакта: если в системе найдет пользователь с таким номером телефона, система кладет ссылку на этого пользователя в новый контакт.~~

~~3. Новый пользователь регистрируется без инвайта: система составляет список всех контактов у всех пользователей, для которых указан номер телефона, введенный только что зарегистрировавшимся пользователем. НО невозможно установить идентичность сущности из справочников и из таблицы пользователей! (связь с контактами с таким же номером телефона устанавливать на первый взгляд нельзя - контакты могли устареть - но ведь и по своим справочникам пользователи больше не дозвонятся до абонентов, а значит, новый пользователь унаследует вместе с номером телефона и имя+должность, и телеграм, и мнение пользователя о человеке (комментарий)~~

~~3. Если новый пользователь регистрируется через инвайт, то кладем ссылку на нового пользователя в контакт того, кто выслал инвайт, который обладает таким же номером телефона. Другим пользователям, опять же, класть нельзя?~~

~~4. При выдаче доступов к шахматке: если пользователь уже существует в системе, его все равно никак не связать с списками контактов этого пользователя.~~

~~5. Изменение атрибутов пользователя никак не отражается на контактах, имеющих, например, такой же номер телефона или не дай бог имеющих откуда-то ссылку на данного пользователя.~~

~~6. Номер телефона как у пользователя, так и у контакта всегда виден другим пользователям (кейс: карточка с контактами и именами и т. д.).~~

~~7. экспорт импорт~~

~~8. руками пользователя импортировать из другой шахматки~~

~~9. Ограничение на длину поля ФИО в контакте - 255 (отражаться в шахматке будут только 15 или по ширине, будет уточнено в отдельных требованиях)~~