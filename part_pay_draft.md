## Наряды и реестры на выплату. Частичное закрытие работ

### Используемые понятия

1. **Наряд** 
2. **Реестр на выплату** (**реестр**) 
3. **Расчетный период** 
4. **Работа**
5. **Отметка об оплате** 
6. **Частичное закрытие наряда** (**процентовка**) 
7. **Перерасход** 

### Предложения по БД

1. Использовать существующие таблицы: **task**, **payment_report**, **payment_report_task**

###  Ключевые тезисы

1. При закрытии наряда работа "на остаток" не пересоздается.
2. Ограничения на попадание работы в наряд упрощаются с:
    1. Статус "Завершено";
    2. Указаны "Исполнители";
    3. Указаны "Объемы";
    4. Отсутствует отметка об оплате.
    до
    1. Указаны "Исполнители";
    2. Указаны "Объемы".
3. Наряд невозможно отредактировать.
4. Наряд невозможно удалить (на текущий момент).
5. Спектр отображаемых данных в наряде необходимо немного расширить.

###  Требования

1. фыва
2. Фильтрация  
    1. Есть кнопка сброса всех фильтров
    2. Есть кнопки сброса каждого фильтра в отдельности
    3. Есть фильтры:
        1. По этажам и помещениям
        3. По исполнителям
        4. По названию работы
        4. ~~По статусу работы~~
3. ~~Вообще статус работы надо выводить как светофор у каждой работы.~~
4. фыва

### Backlog

1. Импорт, экспорт в xlsx и pdf. Печатные формы, работа с документами, системный подход к печати всех доков в продукте.
3. Версионирование - может существенно повлиять на частичное закрытие нардяов.
4. Сортировка работ в "Видах работ" по пользовательскому упорядочению (фактически, по очередности работ).

### E2E

Пользователь (П) - технадзор.

1. **П** заходит в чужую шахматку, где он "Редактор".
2. **П** переходит в раздел "Закрытие нарядов". **П** видит все созданные ранее наряды и кнопку "Создать наряд". Если нарядов пока не было, видит заглушку, где дублируется предложение "Создать наряд". 
4. **П** запускает процесс создания (оно же закрытие) нового наряда. Видит таблицу со списком всех работ, которые есть в шахматке в данное время, у которых указаны исполнители и указаны объемы.
5. **П** выставляет фильтр по названию работы ("Поклейка обоев в м2" и "Поклейка обоев почасовая" - разные), по этажам и помещениям. ~~Выставялет фильтр работ "Готово"~~. Видит список работ, у которых: всевозможные названия и всевозможные исполнители. При этом поля таблицы содержат следующую информацию:
    1. Название работы
    2. Этаж
    3. Помещение
    4. Исполнитель
    5. Объем
    6. Всего (дефектовка)
    7. Процентовка (вычисляемое значение: объем / дефектовку)
    8. Остаток
    9. Расценка
    10. К выплате
6. **П** выбирает чекбоксами интересующие его работы, нажимает на кнопку "Продолжить". Видит экран указания расценок работ.
7. **П** вводит (если в первый раз) или обновляет расценки по работам. 

 



Не нашел нужную ему работу, идет в шахматку и проставляет в ней правильный статус. Возвращается и проходит все шаги 2 - 10 заново. Теперь он видит свою потерявшуюся работу.
