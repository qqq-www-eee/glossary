### Настройка списка работ (списка "Работы")  

<br>

**Работы** - перечень строительных работ, доступных на объекте.   

Система предоставляет пользователю возможность _создавать_, _просматривать_, _редактировать_ и _удалять_ _**список доступных работ**_ (плоский список), а также формировать из числа его элементов _**список работ на объекте**_ (доступны для учёта в шахматке, поддерживают уровни вложенности).  
<br>

<img width="727" alt="image" src="https://user-images.githubusercontent.com/122552428/212556648-078c9611-9280-40ef-baaf-ca7692968db7.png">

_"Список работ на объекте"_

<br>

#### Создание списка доступных работ

1. Для каждого объекта, расположенного в главном меню, пользователь имеет возможность создать _**список доступных работ**_:  
    1. Если к объекту не приклеплено работ, система отобразит стартовый экран с предложением заполнить список работ; 
    2. Если к объекту приклеплена хотя бы одна работа, перед загрузкой новых работ из ~~файла~~ / шаблона / другой шахматки система всегда предлагает пользователю подтвердить действие (заменить уже существующие работы / добавить новые работы в существующий список / отмена);
    3. Наименование работы уникально: если при вводе вручную ~~или при импорте работ~~ встретилось уже используемое наименование работы:
        1.  ручной ввод: ошибка поля: "Данное наименование работы уже используется" - пользователь не сможет добавить работу в _**список доступных работ**_, пока не изменит введенное в поле значение;
        2.  ~~из файла: система самостоятельно пропускает повторы.~~
        3. из другой шахматки - группы с одинаковыми именами претерпевают автоматическое переименование (Вентиляция -> Вентиляция (1)); работы с одинаковыми именами на одном уровне (то есть в корне) претерпевают автоматчическое переименование (Монтаж диффузоров -> Монтаж диффузоров (1));
2. Пользователь может создавать список работ:
    1. ~~из файла ТКП (технико-коммерческое предложение):~~  
        1. ~~Будет реализовано, когда будет понимание структуры ТКП, требования к уникальнсоти полей и пр.~~  
    2. вручную. При нажатии на соответствующий элемент интерфейса система:  
        1. запросит **Наименование работы** и **Единицы измерения**;  
        2. добавит одну новую работу в существующий _**список доступных работ**_ согласно алфавитному порядку;   
    3. склонировав список работ из другой шахматки:  
        1. пользователь может клонировать список работ только из тех шахматок, список работ в которых _не пустой_;
        2. пользователь может клонировать список работ из своих шахматок и из шахматок других пользователей, к которым имеет доступ: 
            1. при выборе шахматки для клонирования свои шахматки и чужие визуально разделены; свои шахматки отображаются выше;
            2. при выборе шахматки для клонирования списка работ должны отображаться:  
                - название шахматки (~~не уникально даже для одного пользователя~~),  
                - ~~автор шахматки (это позволит различить три шахматки "Без названия")~~, 
                - ~~совокупное число доступных работ~~;
            3. По умолчанию управляющий элемент (дропдаун/мультиселект/др.) не заполнен. 
     <br>
     
3. Работы импортируются из ~~файла~~ / шаблона / другой шахматки ВСЕГДА вместе со структурой групп (см. пункт "Импорт" в _**Формирование списка "Работы на объекте"**), то есть как _**список доступных работ**_ со _**списком работ на объекте**_.
<br>

#### Формирование списка "Работы на объекте" (группировка / редактирование / разгруппировка)

_**Работы на объекте**_ будут доступны для отображения в шахматке объекта.

1. Система даёт возможность:
    1. создавать и пополнять _**список работ на объекте**_ элементами (работами) из _**списка доступных работ**_:
        1. если новая работа добавляется в _**список работ на объекте**_, она попадает в корень этого списка;
        2. новая работа может быть добавлена в _**список работ на объекте**_, даже если данная работа уже представлена где-то внутри списка, кроме корня;
        3. если новая работа добавляется в _**список работ на объекте**_, уже содержащий одноименную работу в корне, новая работа добавляется с изменением наименования ("финишная обработка поверхности" -> "финишная обработка поверхности (2)").
            1. для нового наименования работы также осуществляется проверка (цикл, "финишная обработка поверхности (2)" -> "финишная обработка поверхности (3)").
    2. удалять элементы из _**списка работ на объекте**_;
        1. если элемент из _**списка работ на объекте**_ уже был назначен в работу (использован в шахматке),
            1. система выдает модальное окно с вопросом "Работа используется в шахматке (Х помещений). Вы уверены, что хотите безвозвратно удалить работу?".
    2. создавать группу "Вид работ" (аналог пустой папки в файловой системе);
    3. перемещать элементы _**списка работ на объекте**_:
        1. между группами "Вид работ" одной степени вложенности,
        2. между группами "Вид работ" разной степени вложенности (в том числе выносить работу в корень списка);
    4. группировать элементы _**списка работ на объекте**_ в **Вид работ**, причем
        1. группа **Вид работ** может не содержать работ или содержать одну;
        2. функционал осуществляется по нажатию на ту же элементу интерфейса, что создает пустую папку (группу "Вид работ");
    4. ~~группировать группы работ в группу следующего уровня;~~
    6. ~~перемещать группы _**списка работ на объекте**_:~~
        1. ~~между группами одной степени вложенности,~~
        2. ~~между группами разной степени вложенности (в том числе класть группу в корень списка);~~
    7. Удалять группу "Вид работ" вместе со всеми содержащимися работами:
        1. Для элементов вида посчитать, сколько раз они был задействованы в различных помещениях объекта.
        2. если хотя бы один элемент из группы "Вид работ" (папки) уже был назначен в работу (использован в шахматке), система выдает модальное окно, сообщающее, что "Работы данного вида использованы в шахматке (Х помещений). Вы уверены, что хотите безвозвратно удалить группу?".
2. Импорт. Вместе с древовидной структурой _**списка работ на объекте**_;
    1. автоматически структуры групп не мерджатся - пользователь делает это при необходимости вручную; вместо этого одноименные группы и элементы претерпевают автоматическое переименование типа "Вентиляция -> Вентиляция (1)"
    2. новые элементы в _**списке доступных работ**_ и в корне _**списка работ на объекте**_ помещаются среди старых элементов согласно алфавитному порядку.
<br>

#### Просмотр списка доступных работ + просмотр списка работ на объекте

**Доступные работы**:
1. При просмотре _**списка доступных работ**_ отображаются:
    1. наименования работ.
    ~~2. числа всех доступных работ (агрегирующий параметр).~~
2. Можно быстро **выбрать все работы** и **снять выбор всех работ**:
    1. на корневом уровне _**cписка доступных работ**_ (плоский список, других уровней у него нет);
3. Система предоставляет пользователю возможность осуществлять "Быстрый поиск" работ по _**списку доступных работ**_ с поддержкой мультиселекта.  

<img width="250" alt="пример многократного поиска с мультиселектом" src=uploads/1b028797f9f7de370350335d9d492365/606f8819b2507736d0759bb6_multi_select_behavior.gif>

**Работы на объекте**:
1. При просмотре _**список работ на объекте**_ отображаются:
    1. наименования работ,
    ~~2. числа работ работ на объекте (агрегирующий параметр).~~
2. Можно быстро **выбрать все работы** и **снять выбор всех работ**:
    1. на корневом уровне _**списка работ на объекте**_ (выбор всех работ, отображаемых в шахматке);
    2. в рамках одной или нескольких групп работ;
    3. на уровне отдельных работы для действий.
3. Система должна предоставлять пользователю возможность осуществлять "Быстрый поиск" работ по _**списку работ на объекте**_. Во время поиска:
    1. если в группе работа есть работа, имя которой имеет совпадение с запросом поисковой строки, отображать всю группу. 
<br>

#### Редактирование списка доступных работ

1. Можно объединить два и более списка работ в один через модалку при добавлении работ ~~(через отдельную функциональность)~~ (см. раздел **Создание списка доступных работ**). Работы импоритируются из ~~файла~~ / шаблона / другой шахматки в одном из двух режимов: со структурой групп (см. _**"Работы на объекте"**_) или как плоский список (система уточняет у пользователя):
    1. в режиме плоского списка импортируются только _**список доступных работ**_:
        1. элементы в плоском списке _**список доступных работ**_ добавляются в существующий список согласно алфавитному порядку. 
    3. для списка со структурой групп импортируется как _**список доступных работ**_, так и _**список работ на объекте**_:
        1. вместе со структурой группировок _**списка работ на объекте**_;
        2. автоматически структуры групп не мерджатся - пользователь делает это при необходимости вручную;
        3. элементы в _**списке доступных работ**_ и в корне _**списка работ на объекте**_ отсортированы в алфавитном порядке.
2. По умолчанию все вновь добавленные работы получают статус "выбрана".   
<br>

3. Для каждой работы в списке доступных работ пользователь может изменить параметры:
    1. название работы,
    2. единицы измерения.
4. Система должна иметь защиту от внесения случайных изменений в параметры работ.
5. Для каждой работы в списке доступных работ пользователь может создать копию работы с генерацией нового имени работы (напр., "поклейка обоев (2)" или "установка лепного декора (копия)").

#### Удаление списка доступных работ

1. Система должна предоставлять пользователю возможность удалить выбранные работы из _**списка доступных работ**_. При нажатии на соответствующий элемент интерфейса система:  
    1. запросит подтверждение об удалении работы из текущего _**списка доступных работ**_;  
    2. при подтверждении удалит работу из _**списка доступных работ**_ (это не окажет влияния на _**списка работ на объекте**_).
